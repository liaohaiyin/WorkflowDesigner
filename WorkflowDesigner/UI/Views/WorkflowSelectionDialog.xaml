<Window x:Class="WorkflowDesigner.UI.Views.WorkflowSelectionDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:WorkflowDesigner.UI.Views"
        Title="选择工作流" Height="500" Width="700" 
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize"
        Background="#F5F5F5">

    <Window.Resources>
        <!-- 数据网格样式 -->
        <Style x:Key="DataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Height" Value="40"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#BBDEFB"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 标题样式 -->
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
        </Style>
        <local:BooleanToActiveStatusConverter x:Key="BooleanToActiveStatusConverter"/>
        <local:BooleanToStatusColorConverter x:Key="BooleanToStatusColorConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 标题 -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="从数据库选择工作流" FontSize="18" FontWeight="Bold" 
                       Foreground="#2C3E50" HorizontalAlignment="Center"/>
            <Rectangle Height="2" Fill="#3498DB" Margin="0,10,0,0"/>
        </StackPanel>

        <!-- 搜索和过滤区域 -->
        <Border Grid.Row="1" Background="#FFFFFF" BorderBrush="#E0E0E0" 
                BorderThickness="1" Padding="15" Margin="0,0,0,15" CornerRadius="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="搜索:" VerticalAlignment="Center" 
                           Margin="0,0,10,0" Style="{StaticResource HeaderTextStyle}"/>

                <TextBox Grid.Column="1" x:Name="SearchTextBox" 
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Padding="8" BorderBrush="#BDC3C7" BorderThickness="1"
                         VerticalAlignment="Center" Margin="0,0,15,0"
                         ToolTip="搜索工作流名称或描述"/>

                <TextBlock Grid.Column="2" Text="类别:" VerticalAlignment="Center" 
                           Margin="0,0,10,0" Style="{StaticResource HeaderTextStyle}"/>

                <ComboBox Grid.Column="3" x:Name="CategoryFilterComboBox"
                          SelectedValue="{Binding CategoryFilter}"
                          Padding="8" BorderBrush="#BDC3C7" BorderThickness="1"
                          VerticalAlignment="Center">
                    <ComboBoxItem Content="全部类别" Tag="All"/>
                    <ComboBoxItem Content="人事管理" Tag="人事管理"/>
                    <ComboBoxItem Content="财务管理" Tag="财务管理"/>
                    <ComboBoxItem Content="行政管理" Tag="行政管理"/>
                    <ComboBoxItem Content="业务流程" Tag="业务流程"/>
                    <ComboBoxItem Content="其他" Tag="其他"/>
                </ComboBox>
            </Grid>
        </Border>

        <!-- 工作流列表 -->
        <DataGrid Grid.Row="2" x:Name="WorkflowDataGrid"
                  ItemsSource="{Binding FilteredWorkflows}" 
                  SelectedItem="{Binding SelectedWorkflow}"
                  AutoGenerateColumns="False" IsReadOnly="True"
                  GridLinesVisibility="None" HeadersVisibility="Column"
                  RowStyle="{StaticResource DataGridRowStyle}"
                  SelectionMode="Single" CanUserResizeRows="False"
                  Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1">

            <DataGrid.Columns>
                <!-- 工作流名称 -->
                <DataGridTextColumn Header="工作流名称" Binding="{Binding Name}" Width="200">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="Foreground" Value="#2C3E50"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Margin" Value="8,0"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- 描述 -->
                <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextWrapping" Value="Wrap"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Margin" Value="8,0"/>
                            <Setter Property="Foreground" Value="#34495E"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- 版本 -->
                <DataGridTextColumn Header="版本" Binding="{Binding Version}" Width="80">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="FontFamily" Value="Consolas"/>
                            <Setter Property="Foreground" Value="#7F8C8D"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- 类别 -->
                <DataGridTextColumn Header="类别" Binding="{Binding Category}" Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Foreground" Value="#8E44AD"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- 创建时间 -->
                <DataGridTextColumn Header="创建时间" Binding="{Binding CreatedTime, StringFormat='yyyy-MM-dd HH:mm'}" Width="130">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="FontFamily" Value="Consolas"/>
                            <Setter Property="FontSize" Value="11"/>
                            <Setter Property="Foreground" Value="#95A5A6"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- 创建人 -->
                <DataGridTextColumn Header="创建人" Binding="{Binding CreatedBy}" Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            <Setter Property="VerticalAlignment" Value="Center"/>
                            <Setter Property="Foreground" Value="#34495E"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- 工作流详细信息 -->
        <Border Grid.Row="3" Background="#FFFFFF" BorderBrush="#E0E0E0" 
                BorderThickness="1" Padding="15" Margin="0,15,0,0" CornerRadius="5"
                Visibility="{Binding HasSelectedWorkflow, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid DataContext="{Binding SelectedWorkflow}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" 
                           Text="工作流详细信息" FontWeight="Bold" FontSize="14" 
                           Foreground="#2C3E50" Margin="0,0,0,10"/>

                <!-- 左列信息 -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,15,0">
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="ID: " FontWeight="SemiBold" Width="60"/>
                        <TextBlock Text="{Binding Id}" FontFamily="Consolas" FontSize="11"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="版本: " FontWeight="SemiBold" Width="60"/>
                        <TextBlock Text="{Binding Version}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="类别: " FontWeight="SemiBold" Width="60"/>
                        <TextBlock Text="{Binding Category}"/>
                    </StackPanel>
                </StackPanel>

                <!-- 右列信息 -->
                <StackPanel Grid.Row="1" Grid.Column="1">
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="创建时间: " FontWeight="SemiBold" Width="70"/>
                        <TextBlock Text="{Binding CreatedTime, StringFormat='yyyy-MM-dd HH:mm:ss'}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="创建人: " FontWeight="SemiBold" Width="70"/>
                        <TextBlock Text="{Binding CreatedBy}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,5">
                        <TextBlock Text="状态: " FontWeight="SemiBold" Width="70"/>
                        <TextBlock Text="{Binding IsActive, Converter={StaticResource BooleanToActiveStatusConverter}}" 
                                   Foreground="{Binding IsActive, Converter={StaticResource BooleanToStatusColorConverter}}"/>
                    </StackPanel>
                </StackPanel>

                <!-- 描述 -->
                <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" 
                           Text="{Binding Description}" TextWrapping="Wrap" 
                           Margin="0,10,0,0" Foreground="#34495E"
                           Visibility="{Binding Description, Converter={StaticResource StringEmptyToVisibilityConverter}}"/>
            </Grid>
        </Border>

        <!-- 按钮区域 -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" 
                    HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="加载选中的工作流" x:Name="LoadButton" 
                    Click="LoadButton_Click" Padding="20,10" Margin="0,0,15,0" 
                    IsDefault="True" Background="#2ECC71" Foreground="White" 
                    BorderThickness="0" FontWeight="SemiBold"
                    IsEnabled="{Binding HasSelectedWorkflow}"
                    ToolTip="加载选中的工作流到设计器"/>

            <Button Content="刷新列表" x:Name="RefreshButton" 
                    Click="RefreshButton_Click" Padding="15,10" Margin="0,0,15,0" 
                    Background="#3498DB" Foreground="White" 
                    BorderThickness="0" FontWeight="SemiBold"
                    ToolTip="重新从数据库加载工作流列表"/>

            <Button Content="取消" x:Name="CancelButton" 
                    Click="CancelButton_Click" Padding="20,10" 
                    IsCancel="True" Background="#95A5A6" Foreground="White" 
                    BorderThickness="0" FontWeight="SemiBold"/>
        </StackPanel>
    </Grid>
</Window>