<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Info"
      internalLogFile="logs\internal-nlog.txt">

	<!-- 定义变量 -->
	<variable name="logDirectory" value="logs"/>
	<variable name="applicationName" value="WorkflowDesigner"/>

	<!-- 日志目标 -->
	<targets>

		<!-- 文件日志 - 全部日志 -->
		<target xsi:type="File"
				name="allFileLog"
				fileName="${logDirectory}\${applicationName}-${shortdate}.log"
				archiveFileName="${logDirectory}\archive\${applicationName}-{#}.log"
				archiveNumbering="Date"
				archiveEvery="Day"
				archiveDateFormat="yyyy-MM-dd"
				maxArchiveFiles="30"
				keepFileOpen="false"
				encoding="utf-8"
				layout="${longdate} ${uppercase:${level}} ${logger} ${message} ${exception:format=tostring}"/>

		<!-- 文件日志 - 错误日志 -->
		<target xsi:type="File"
				name="errorFileLog"
				fileName="${logDirectory}\${applicationName}-errors-${shortdate}.log"
				archiveFileName="${logDirectory}\archive\${applicationName}-errors-{#}.log"
				archiveNumbering="Date"
				archiveEvery="Day"
				archiveDateFormat="yyyy-MM-dd"
				maxArchiveFiles="90"
				keepFileOpen="false"
				encoding="utf-8"
				layout="${longdate} ${uppercase:${level}} ${logger} ${message} ${exception:format=tostring}"/>

		<!-- 数据库日志 -->
		<target xsi:type="File"
				name="databaseLog"
				fileName="${logDirectory}\${applicationName}-database-${shortdate}.log"
				archiveFileName="${logDirectory}\archive\${applicationName}-database-{#}.log"
				archiveNumbering="Date"
				archiveEvery="Day"
				archiveDateFormat="yyyy-MM-dd"
				maxArchiveFiles="30"
				keepFileOpen="false"
				encoding="utf-8"
				layout="${longdate} ${uppercase:${level}} ${logger} ${message} ${exception:format=tostring}"/>

		<!-- 工作流引擎日志 -->
		<target xsi:type="File"
				name="workflowLog"
				fileName="${logDirectory}\${applicationName}-workflow-${shortdate}.log"
				archiveFileName="${logDirectory}\archive\${applicationName}-workflow-{#}.log"
				archiveNumbering="Date"
				archiveEvery="Day"
				archiveDateFormat="yyyy-MM-dd"
				maxArchiveFiles="30"
				keepFileOpen="false"
				encoding="utf-8"
				layout="${longdate} ${uppercase:${level}} ${logger} ${message} ${exception:format=tostring}"/>

		<!-- 控制台日志 (开发环境) -->
		<target xsi:type="Console"
				name="consoleLog"
				layout="${time} ${uppercase:${level}} ${logger:shortName=true} ${message} ${exception:format=tostring}"/>

		<!-- 调试输出 (开发环境) -->
		<target xsi:type="Debugger"
				name="debugLog"
				layout="${time} ${uppercase:${level}} ${logger:shortName=true} ${message}"/>

		<!-- 彩色控制台 (开发环境) -->
		<target xsi:type="ColoredConsole"
				name="coloredConsoleLog"
				layout="${time} ${uppercase:${level}} ${logger:shortName=true} ${message} ${exception:format=tostring}">
			<highlight-row condition="level == LogLevel.Debug" foregroundColor="DarkGray"/>
			<highlight-row condition="level == LogLevel.Info" foregroundColor="Gray"/>
			<highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow"/>
			<highlight-row condition="level == LogLevel.Error" foregroundColor="Red"/>
			<highlight-row condition="level == LogLevel.Fatal" foregroundColor="Red" backgroundColor="White"/>
		</target>

	</targets>

	<!-- 日志规则 -->
	<rules>

		<!-- 数据库相关日志 -->
		<logger name="WorkflowDesigner.Infrastructure.Data.*" minlevel="Debug" writeTo="databaseLog"/>
		<logger name="WorkflowDesigner.Infrastructure.Database.*" minlevel="Debug" writeTo="databaseLog"/>

		<!-- 工作流引擎日志 -->
		<logger name="WorkflowDesigner.Engine.*" minlevel="Debug" writeTo="workflowLog"/>
		<logger name="WorkflowDesigner.Core.Services.*" minlevel="Debug" writeTo="workflowLog"/>

		<!-- 错误日志 -->
		<logger name="*" level="Error" writeTo="errorFileLog"/>
		<logger name="*" level="Fatal" writeTo="errorFileLog"/>

		<!-- 全部日志到文件 -->
		<logger name="*" minlevel="Info" writeTo="allFileLog"/>

		<!-- 开发环境 - 控制台日志 -->
		<logger name="*" minlevel="Debug" writeTo="coloredConsoleLog">
			<filters>
				<!-- 只在开发环境启用 -->
				<when condition="'${environment:ASPNETCORE_ENVIRONMENT}' == 'Development'" action="Log"/>
				<when condition="true" action="Ignore"/>
			</filters>
		</logger>

		<!-- 调试输出 -->
		<logger name="*" minlevel="Trace" writeTo="debugLog">
			<filters>
				<!-- 只在调试模式启用 -->
				<when condition="'${configsetting:name=LogLevel}' == 'Debug'" action="Log"/>
				<when condition="true" action="Ignore"/>
			</filters>
		</logger>

		<!-- 排除一些噪音日志 -->
		<logger name="Microsoft.*" maxlevel="Info" final="true"/>
		<logger name="System.Net.Http.*" maxlevel="Info" final="true"/>

	</rules>

</nlog>