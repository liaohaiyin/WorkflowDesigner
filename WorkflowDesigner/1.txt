// ==================== Âü∫Á°ÄÊûö‰∏æÂíåÊ®°Âûã ====================

public enum WorkflowNodeType
{
    Start,          // ÂºÄÂßãËäÇÁÇπ
    End,            // ÁªìÊùüËäÇÁÇπ
    Approval,       // ÂÆ°ÊâπËäÇÁÇπ
    Decision,       // Âà§Êñ≠ËäÇÁÇπ
    Task,           // ‰ªªÂä°ËäÇÁÇπ
    Notification,   // ÈÄöÁü•ËäÇÁÇπ
    DataOperation,  // Êï∞ÊçÆÊìç‰ΩúËäÇÁÇπ
    Timer,          // ÂÆöÊó∂Âô®ËäÇÁÇπ
    SubWorkflow     // Â≠êÊµÅÁ®ãËäÇÁÇπ
}

public enum NodeExecutionStatus
{
    Pending,        // ÂæÖÂ§ÑÁêÜ
    InProgress,     // ËøõË°å‰∏≠
    Completed,      // Â∑≤ÂÆåÊàê
    Failed,         // Â§±Ë¥•
    Timeout,        // Ë∂ÖÊó∂
    Skipped,        // Ë∑≥Ëøá
    Cancelled       // ÂèñÊ∂à
}

public enum ApprovalStrategy
{
    Sequential,     // ‰∏≤Ë°åÂÆ°Êâπ
    Parallel,       // Âπ∂Ë°åÂÆ°Êâπ
    Voting,         // ÊäïÁ•®ÂÆ°Êâπ
    FirstApproval   // Á¨¨‰∏Ä‰∫∫ÂÆ°ÊâπÂç≥ÂèØ
}

public enum TimeoutAction
{
    AutoApprove,    // Ëá™Âä®ÈÄöËøá
    AutoReject,     // Ëá™Âä®ÊãíÁªù
    Escalate,       // ÂçáÁ∫ßÂ§ÑÁêÜ
    Reassign        // ÈáçÊñ∞ÂàÜÈÖç
}

// ==================== Âü∫Á°ÄÂ∑•‰ΩúÊµÅËäÇÁÇπÁ±ª ====================

public abstract class WorkflowNodeViewModel : CodeGenNodeViewModel
{
    public string NodeId { get; set; } = Guid.NewGuid().ToString();
    public string DisplayName { get; set; }
    public string Description { get; set; }
    public WorkflowNodeType WorkflowNodeType { get; }
    
    #region ExecutionStatus
    public NodeExecutionStatus ExecutionStatus
    {
        get => _executionStatus;
        set
        {
            this.RaiseAndSetIfChanged(ref _executionStatus, value);
            UpdateNodeAppearance();
        }
    }
    private NodeExecutionStatus _executionStatus = NodeExecutionStatus.Pending;
    #endregion

    #region TimeoutDuration
    public TimeSpan? TimeoutDuration
    {
        get => _timeoutDuration;
        set => this.RaiseAndSetIfChanged(ref _timeoutDuration, value);
    }
    private TimeSpan? _timeoutDuration;
    #endregion

    public Dictionary<string, object> Properties { get; set; } = new Dictionary<string, object>();

    protected WorkflowNodeViewModel(WorkflowNodeType nodeType) : base(NodeType.FlowControl)
    {
        WorkflowNodeType = nodeType;
        UpdateNodeAppearance();
    }

    private void UpdateNodeAppearance()
    {
        // Ê†πÊçÆÊâßË°åÁä∂ÊÄÅÊõ¥Êñ∞ËäÇÁÇπÂ§ñËßÇ
        Background = GetStatusColor(ExecutionStatus);
    }

    private Brush GetStatusColor(NodeExecutionStatus status)
    {
        return status switch
        {
            NodeExecutionStatus.Pending => new SolidColorBrush(Color.FromRgb(0xE0, 0xE0, 0xE0)),
            NodeExecutionStatus.InProgress => new SolidColorBrush(Color.FromRgb(0x4C, 0xAF, 0x50)),
            NodeExecutionStatus.Completed => new SolidColorBrush(Color.FromRgb(0x2E, 0x7D, 0x32)),
            NodeExecutionStatus.Failed => new SolidColorBrush(Color.FromRgb(0xF4, 0x43, 0x36)),
            NodeExecutionStatus.Timeout => new SolidColorBrush(Color.FromRgb(0xFF, 0x98, 0x00)),
            NodeExecutionStatus.Skipped => new SolidColorBrush(Color.FromRgb(0x9E, 0x9E, 0x9E)),
            NodeExecutionStatus.Cancelled => new SolidColorBrush(Color.FromRgb(0x75, 0x75, 0x75)),
            _ => new SolidColorBrush(Color.FromRgb(0xE0, 0xE0, 0xE0))
        };
    }

    public abstract bool CanExecute(WorkflowContext context);
    public abstract Task<NodeExecutionResult> ExecuteAsync(WorkflowContext context);
}

// ==================== ÂÆ°ÊâπËäÇÁÇπÂÆûÁé∞ ====================

public class ApprovalNodeViewModel : WorkflowNodeViewModel
{
    static ApprovalNodeViewModel()
    {
        Splat.Locator.CurrentMutable.Register(() => new WorkflowNodeView(), typeof(IViewFor<ApprovalNodeViewModel>));
    }

    #region ApprovalStrategy
    public ApprovalStrategy Strategy
    {
        get => _strategy;
        set => this.RaiseAndSetIfChanged(ref _strategy, value);
    }
    private ApprovalStrategy _strategy = ApprovalStrategy.Sequential;
    #endregion

    #region Approvers
    public ObservableCollection<string> Approvers { get; } = new ObservableCollection<string>();
    #endregion

    #region RequiredApprovals
    public int RequiredApprovals
    {
        get => _requiredApprovals;
        set => this.RaiseAndSetIfChanged(ref _requiredApprovals, value);
    }
    private int _requiredApprovals = 1;
    #endregion

    #region TimeoutAction
    public TimeoutAction TimeoutAction
    {
        get => _timeoutAction;
        set => this.RaiseAndSetIfChanged(ref _timeoutAction, value);
    }
    private TimeoutAction _timeoutAction = TimeoutAction.Escalate;
    #endregion

    #region ApprovalComments
    public string ApprovalComments
    {
        get => _approvalComments;
        set => this.RaiseAndSetIfChanged(ref _approvalComments, value);
    }
    private string _approvalComments = "";
    #endregion

    public ValueNodeInputViewModel<IStatement> FlowInput { get; }
    public ValueNodeOutputViewModel<IStatement> ApprovedOutput { get; }
    public ValueNodeOutputViewModel<IStatement> RejectedOutput { get; }

    public ApprovalNodeViewModel() : base(WorkflowNodeType.Approval)
    {
        this.Name = "ÂÆ°ÊâπËäÇÁÇπ";
        DisplayName = "ÂÆ°ÊâπËäÇÁÇπ";

        // ÊµÅÁ®ãËæìÂÖ•Á´ØÂè£
        FlowInput = new CodeGenInputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ËæìÂÖ•"
        };
        this.Inputs.Add(FlowInput);

        // ÂÆ°ÊâπÈÄöËøáËæìÂá∫Á´ØÂè£
        ApprovedOutput = new CodeGenOutputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ÈÄöËøá",
            Value = Observable.Return(new StubStatement())
        };
        this.Outputs.Add(ApprovedOutput);

        // ÂÆ°ÊâπÊãíÁªùËæìÂá∫Á´ØÂè£
        RejectedOutput = new CodeGenOutputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ÊãíÁªù",
            Value = Observable.Return(new StubStatement())
        };
        this.Outputs.Add(RejectedOutput);
    }

    public override bool CanExecute(WorkflowContext context)
    {
        return Approvers.Any() && !string.IsNullOrEmpty(DisplayName);
    }

    public override async Task<NodeExecutionResult> ExecuteAsync(WorkflowContext context)
    {
        ExecutionStatus = NodeExecutionStatus.InProgress;
        
        try
        {
            // ËøôÈáåÂÆûÁé∞ÂÖ∑‰ΩìÁöÑÂÆ°ÊâπÈÄªËæë
            // 1. Ê†πÊçÆÁ≠ñÁï•ÂàÜÈÖçÂÆ°Êâπ‰ªªÂä°
            // 2. Á≠âÂæÖÂÆ°ÊâπÁªìÊûú
            // 3. Â§ÑÁêÜË∂ÖÊó∂ÊÉÖÂÜµ
            
            var result = await ProcessApprovalAsync(context);
            
            ExecutionStatus = result.IsSuccess ? NodeExecutionStatus.Completed : NodeExecutionStatus.Failed;
            return result;
        }
        catch (Exception ex)
        {
            ExecutionStatus = NodeExecutionStatus.Failed;
            return NodeExecutionResult.Failure(ex.Message);
        }
    }

    private async Task<NodeExecutionResult> ProcessApprovalAsync(WorkflowContext context)
    {
        // Ê®°ÊãüÂÆ°ÊâπÂ§ÑÁêÜÈÄªËæë
        await Task.Delay(1000); // Ê®°ÊãüÂ§ÑÁêÜÊó∂Èó¥
        return NodeExecutionResult.Success("ÂÆ°ÊâπÂÆåÊàê");
    }
}

// ==================== Âà§Êñ≠ËäÇÁÇπÂÆûÁé∞ ====================

public class DecisionNodeViewModel : WorkflowNodeViewModel
{
    static DecisionNodeViewModel()
    {
        Splat.Locator.CurrentMutable.Register(() => new WorkflowNodeView(), typeof(IViewFor<DecisionNodeViewModel>));
    }

    #region Conditions
    public ObservableCollection<ConditionRule> Conditions { get; } = new ObservableCollection<ConditionRule>();
    #endregion

    #region LogicalOperator
    public LogicalOperator Operator
    {
        get => _operator;
        set => this.RaiseAndSetIfChanged(ref _operator, value);
    }
    private LogicalOperator _operator = LogicalOperator.And;
    #endregion

    public ValueNodeInputViewModel<IStatement> FlowInput { get; }
    public ValueNodeOutputViewModel<IStatement> TrueOutput { get; }
    public ValueNodeOutputViewModel<IStatement> FalseOutput { get; }

    public DecisionNodeViewModel() : base(WorkflowNodeType.Decision)
    {
        this.Name = "Âà§Êñ≠ËäÇÁÇπ";
        DisplayName = "Âà§Êñ≠ËäÇÁÇπ";

        FlowInput = new CodeGenInputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ËæìÂÖ•"
        };
        this.Inputs.Add(FlowInput);

        TrueOutput = new CodeGenOutputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ÊòØ",
            Value = Observable.Return(new StubStatement())
        };
        this.Outputs.Add(TrueOutput);

        FalseOutput = new CodeGenOutputViewModel<IStatement>(PortType.Execution)
        {
            Name = "Âê¶",
            Value = Observable.Return(new StubStatement())
        };
        this.Outputs.Add(FalseOutput);
    }

    public override bool CanExecute(WorkflowContext context)
    {
        return Conditions.Any();
    }

    public override async Task<NodeExecutionResult> ExecuteAsync(WorkflowContext context)
    {
        ExecutionStatus = NodeExecutionStatus.InProgress;
        
        try
        {
            bool result = EvaluateConditions(context);
            ExecutionStatus = NodeExecutionStatus.Completed;
            
            return NodeExecutionResult.Success($"Êù°‰ª∂Âà§Êñ≠ÁªìÊûú: {result}");
        }
        catch (Exception ex)
        {
            ExecutionStatus = NodeExecutionStatus.Failed;
            return NodeExecutionResult.Failure(ex.Message);
        }
    }

    private bool EvaluateConditions(WorkflowContext context)
    {
        if (!Conditions.Any()) return true;

        return Operator == LogicalOperator.And
            ? Conditions.All(c => c.Evaluate(context))
            : Conditions.Any(c => c.Evaluate(context));
    }
}

// ==================== ‰ªªÂä°ËäÇÁÇπÂÆûÁé∞ ====================

public class TaskNodeViewModel : WorkflowNodeViewModel
{
    static TaskNodeViewModel()
    {
        Splat.Locator.CurrentMutable.Register(() => new WorkflowNodeView(), typeof(IViewFor<TaskNodeViewModel>));
    }

    #region TaskType
    public TaskType TaskType
    {
        get => _taskType;
        set => this.RaiseAndSetIfChanged(ref _taskType, value);
    }
    private TaskType _taskType = TaskType.Manual;
    #endregion

    #region Assignees
    public ObservableCollection<string> Assignees { get; } = new ObservableCollection<string>();
    #endregion

    #region Instructions
    public string Instructions
    {
        get => _instructions;
        set => this.RaiseAndSetIfChanged(ref _instructions, value);
    }
    private string _instructions = "";
    #endregion

    #region FormFields
    public ObservableCollection<FormField> FormFields { get; } = new ObservableCollection<FormField>();
    #endregion

    public ValueNodeInputViewModel<IStatement> FlowInput { get; }
    public ValueNodeOutputViewModel<IStatement> FlowOutput { get; }

    public TaskNodeViewModel() : base(WorkflowNodeType.Task)
    {
        this.Name = "‰ªªÂä°ËäÇÁÇπ";
        DisplayName = "‰ªªÂä°ËäÇÁÇπ";

        FlowInput = new CodeGenInputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ËæìÂÖ•"
        };
        this.Inputs.Add(FlowInput);

        FlowOutput = new CodeGenOutputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ËæìÂá∫",
            Value = Observable.Return(new StubStatement())
        };
        this.Outputs.Add(FlowOutput);
    }

    public override bool CanExecute(WorkflowContext context)
    {
        return Assignees.Any() && !string.IsNullOrEmpty(Instructions);
    }

    public override async Task<NodeExecutionResult> ExecuteAsync(WorkflowContext context)
    {
        ExecutionStatus = NodeExecutionStatus.InProgress;
        
        try
        {
            if (TaskType == TaskType.Automatic)
            {
                // Ëá™Âä®‰ªªÂä°Â§ÑÁêÜ
                await ProcessAutomaticTaskAsync(context);
            }
            else
            {
                // ‰∫∫Â∑•‰ªªÂä°Â§ÑÁêÜ - Á≠âÂæÖÁî®Êà∑ÂÆåÊàê
                await ProcessManualTaskAsync(context);
            }
            
            ExecutionStatus = NodeExecutionStatus.Completed;
            return NodeExecutionResult.Success("‰ªªÂä°ÂÆåÊàê");
        }
        catch (Exception ex)
        {
            ExecutionStatus = NodeExecutionStatus.Failed;
            return NodeExecutionResult.Failure(ex.Message);
        }
    }

    private async Task ProcessAutomaticTaskAsync(WorkflowContext context)
    {
        // Ëá™Âä®‰ªªÂä°Â§ÑÁêÜÈÄªËæë
        await Task.Delay(500);
    }

    private async Task ProcessManualTaskAsync(WorkflowContext context)
    {
        // ‰∫∫Â∑•‰ªªÂä°Â§ÑÁêÜÈÄªËæë - ÂàõÂª∫ÂæÖÂäû‰∫ãÈ°π
        await Task.Delay(100);
    }
}

// ==================== ÈÄöÁü•ËäÇÁÇπÂÆûÁé∞ ====================

public class NotificationNodeViewModel : WorkflowNodeViewModel
{
    static NotificationNodeViewModel()
    {
        Splat.Locator.CurrentMutable.Register(() => new WorkflowNodeView(), typeof(IViewFor<NotificationNodeViewModel>));
    }

    #region NotificationType
    public NotificationType NotificationType
    {
        get => _notificationType;
        set => this.RaiseAndSetIfChanged(ref _notificationType, value);
    }
    private NotificationType _notificationType = NotificationType.Email;
    #endregion

    #region Recipients
    public ObservableCollection<string> Recipients { get; } = new ObservableCollection<string>();
    #endregion

    #region MessageTemplate
    public string MessageTemplate
    {
        get => _messageTemplate;
        set => this.RaiseAndSetIfChanged(ref _messageTemplate, value);
    }
    private string _messageTemplate = "";
    #endregion

    #region Subject
    public string Subject
    {
        get => _subject;
        set => this.RaiseAndSetIfChanged(ref _subject, value);
    }
    private string _subject = "";
    #endregion

    public ValueNodeInputViewModel<IStatement> FlowInput { get; }
    public ValueNodeOutputViewModel<IStatement> FlowOutput { get; }

    public NotificationNodeViewModel() : base(WorkflowNodeType.Notification)
    {
        this.Name = "ÈÄöÁü•ËäÇÁÇπ";
        DisplayName = "ÈÄöÁü•ËäÇÁÇπ";

        FlowInput = new CodeGenInputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ËæìÂÖ•"
        };
        this.Inputs.Add(FlowInput);

        FlowOutput = new CodeGenOutputViewModel<IStatement>(PortType.Execution)
        {
            Name = "ËæìÂá∫",
            Value = Observable.Return(new StubStatement())
        };
        this.Outputs.Add(FlowOutput);
    }

    public override bool CanExecute(WorkflowContext context)
    {
        return Recipients.Any() && !string.IsNullOrEmpty(MessageTemplate);
    }

    public override async Task<NodeExecutionResult> ExecuteAsync(WorkflowContext context)
    {
        ExecutionStatus = NodeExecutionStatus.InProgress;
        
        try
        {
            await SendNotificationAsync(context);
            ExecutionStatus = NodeExecutionStatus.Completed;
            return NodeExecutionResult.Success("ÈÄöÁü•ÂèëÈÄÅÊàêÂäü");
        }
    }


    <!-- ==================== ‰∏ªÁ™óÂè£ËßÜÂõæ ==================== -->
<!-- Views/WorkflowDesignerWindow.xaml -->
<Window x:Class="WorkflowDesigner.Views.WorkflowDesignerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="clr-namespace:NodeNetwork.Views;assembly=NodeNetwork"
        xmlns:nodeList="clr-namespace:NodeNetwork.Toolkit.NodeList;assembly=NodeNetworkToolkit"
        xmlns:breadcrumbBar="clr-namespace:NodeNetwork.Toolkit.BreadcrumbBar;assembly=NodeNetworkToolkit"
        xmlns:local="clr-namespace:WorkflowDesigner.Views"
        mc:Ignorable="d"
        Title="Â∑•‰ΩúÊµÅÂèØËßÜÂåñËÆæËÆ°Âô®" Height="800" Width="1400"
        WindowState="Maximized">
    
    <Window.Resources>
        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3F2FD"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="StatusBarTextStyle" TargetType="TextBlock">
            <Setter Property="Margin" Value="10,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Â∑•ÂÖ∑Ê†è -->
            <RowDefinition Height="Auto"/>  <!-- Èù¢ÂåÖÂ±ëÂØºËà™ -->
            <RowDefinition Height="*"/>     <!-- ‰∏ªÂ∑•‰ΩúÂå∫ -->
            <RowDefinition Height="Auto"/>  <!-- Áä∂ÊÄÅÊ†è -->
        </Grid.RowDefinitions>

        <!-- Â∑•ÂÖ∑Ê†è -->
        <ToolBar Grid.Row="0" Background="#F5F5F5" Height="40">
            <Button x:Name="NewButton" Style="{StaticResource ToolbarButtonStyle}" ToolTip="Êñ∞Âª∫Â∑•‰ΩúÊµÅ">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="üìÑ" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Êñ∞Âª∫"/>
                </StackPanel>
            </Button>
            <Button x:Name="SaveButton" Style="{StaticResource ToolbarButtonStyle}" ToolTip="‰øùÂ≠òÂ∑•‰ΩúÊµÅ">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="üíæ" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="‰øùÂ≠ò"/>
                </StackPanel>
            </Button>
            <Button x:Name="LoadButton" Style="{StaticResource ToolbarButtonStyle}" ToolTip="Âä†ËΩΩÂ∑•‰ΩúÊµÅ">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="üìÇ" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="ÊâìÂºÄ"/>
                </StackPanel>
            </Button>
            <Separator/>
            <Button x:Name="RunButton" Style="{StaticResource ToolbarButtonStyle}" ToolTip="ËøêË°åÂ∑•‰ΩúÊµÅ">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="‚ñ∂Ô∏è" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="ËøêË°å"/>
                </StackPanel>
            </Button>
            <Button x:Name="StopButton" Style="{StaticResource ToolbarButtonStyle}" ToolTip="ÂÅúÊ≠¢Â∑•‰ΩúÊµÅ">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="‚èπÔ∏è" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="ÂÅúÊ≠¢"/>
                </StackPanel>
            </Button>
            <Separator/>
            <Button x:Name="ValidateButton" Style="{StaticResource ToolbarButtonStyle}" ToolTip="È™åËØÅÂ∑•‰ΩúÊµÅ">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="‚úÖ" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="È™åËØÅ"/>
                </StackPanel>
            </Button>
            <Button x:Name="AutoLayoutButton" Style="{StaticResource ToolbarButtonStyle}" ToolTip="Ëá™Âä®Â∏ÉÂ±Ä">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="üîß" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Ëá™Âä®Â∏ÉÂ±Ä"/>
                </StackPanel>
            </Button>
        </ToolBar>

        <!-- Èù¢ÂåÖÂ±ëÂØºËà™ -->
        <breadcrumbBar:BreadcrumbBarView x:Name="BreadcrumbBar" Grid.Row="1" MinHeight="30" Background="#EEEEEE"/>

        <!-- ‰∏ªÂ∑•‰ΩúÂå∫ -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>   <!-- ËäÇÁÇπÈù¢Êùø -->
                <ColumnDefinition Width="5"/>     <!-- ÂàÜÈöîÂô® -->
                <ColumnDefinition Width="*"/>     <!-- ÁîªÂ∏ÉÂå∫Âüü -->
                <ColumnDefinition Width="5"/>     <!-- ÂàÜÈöîÂô® -->
                <ColumnDefinition Width="300"/>   <!-- Â±ûÊÄßÈù¢Êùø -->
            </Grid.ColumnDefinitions>

            <!-- ËäÇÁÇπÈù¢Êùø -->
            <Grid Grid.Column="0" Background="#FAFAFA">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <Border Grid.Row="0" Background="#E3F2FD" Padding="10">
                    <TextBlock Text="ËäÇÁÇπÂ∑•ÂÖ∑ÁÆ±" FontWeight="Bold" FontSize="14"/>
                </Border>
                
                <nodeList:NodeListView x:Name="NodeListView" Grid.Row="1" Margin="5"/>
            </Grid>

            <GridSplitter Grid.Column="1" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="#DDDDDD"/>

            <!-- ÁîªÂ∏ÉÂå∫Âüü -->
            <views:NetworkView x:Name="NetworkView" Grid.Column="2">
                <views:NetworkView.NetworkBackground>
                    <DrawingBrush TileMode="Tile" Viewport="0,0,20,20" ViewportUnits="Absolute" 
                                  Viewbox="0,0,20,20" ViewboxUnits="Absolute" Opacity="0.3">
                        <DrawingBrush.Drawing>
                            <GeometryDrawing Brush="LightGray">
                                <GeometryDrawing.Geometry>
                                    <RectangleGeometry Rect="0,0,1,1"/>
                                </GeometryDrawing.Geometry>
                            </GeometryDrawing>
                        </DrawingBrush.Drawing>
                    </DrawingBrush>
                </views:NetworkView.NetworkBackground>
            </views:NetworkView>

            <GridSplitter Grid.Column="3" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="#DDDDDD"/>

            <!-- Â±ûÊÄßÈù¢Êùø -->
            <Grid Grid.Column="4" Background="#FAFAFA">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="200"/>
                </Grid.RowDefinitions>

                <!-- Â±ûÊÄßÈù¢ÊùøÊ†áÈ¢ò -->
                <Border Grid.Row="0" Background="#E3F2FD" Padding="10">
                    <TextBlock Text="Â±ûÊÄßÈÖçÁΩÆ" FontWeight="Bold" FontSize="14"/>
                </Border>

                <!-- Â±ûÊÄßÁºñËæëÂå∫Âüü -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ContentPresenter x:Name="PropertyContentPresenter" Margin="10"/>
                </ScrollViewer>

                <!-- Â∑•‰ΩúÊµÅÁõëÊéßÊ†áÈ¢ò -->
                <Border Grid.Row="2" Background="#FFF3E0" Padding="10">
                    <TextBlock Text="Â∑•‰ΩúÊµÅÁõëÊéß" FontWeight="Bold" FontSize="14"/>
                </Border>

                <!-- Â∑•‰ΩúÊµÅÁä∂ÊÄÅÁõëÊéß -->
                <local:WorkflowMonitorView x:Name="WorkflowMonitorView" Grid.Row="3"/>
            </Grid>
        </Grid>

        <!-- Áä∂ÊÄÅÊ†è -->
        <StatusBar Grid.Row="3" Background="#F0F0F0" Height="25">
            <TextBlock x:Name="StatusText" Style="{StaticResource StatusBarTextStyle}" Text="Â∞±Áª™"/>
            <Separator/>
            <TextBlock x:Name="NodeCountText" Style="{StaticResource StatusBarTextStyle}"/>
            <Separator/>
            <TextBlock x:Name="ConnectionCountText" Style="{StaticResource StatusBarTextStyle}"/>
        </StatusBar>
    </Grid>
</Window>

<!-- ==================== Â∑•‰ΩúÊµÅËäÇÁÇπËßÜÂõæ ==================== -->
<!-- Views/WorkflowNodeView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.WorkflowNodeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="clr-namespace:NodeNetwork.Views;assembly=NodeNetwork">
    
    <UserControl.Resources>
        <Style x:Key="NodeStatusIndicator" TargetType="Ellipse">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Height" Value="10"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <views:NodeView x:Name="NodeView">
        <views:NodeView.HeaderStyle>
            <Style TargetType="ContentPresenter">
                <Setter Property="Content">
                    <Setter.Value>
                        <StackPanel Orientation="Horizontal">
                            <Ellipse x:Name="StatusIndicator" Style="{StaticResource NodeStatusIndicator}"/>
                            <TextBlock Text="{Binding Name}" FontWeight="Bold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Setter.Value>
                </Setter>
            </Style>
        </views:NodeView.HeaderStyle>
    </views:NodeView>
</UserControl>

<!-- ==================== ÂÆ°ÊâπËäÇÁÇπÂ±ûÊÄßÈù¢Êùø ==================== -->
<!-- Views/Properties/ApprovalNodePropertyView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.Properties.ApprovalNodePropertyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel Margin="10">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <GroupBox Header="Âü∫Êú¨‰ø°ÊÅØ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËäÇÁÇπÂêçÁß∞:"/>
                <TextBox x:Name="DisplayNameTextBox" Margin="0,0,0,10"/>
                
                <Label Content="ÊèèËø∞:"/>
                <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>

        <!-- ÂÆ°Êâπ‰∫∫ÈÖçÁΩÆ -->
        <GroupBox Header="ÂÆ°Êâπ‰∫∫ÈÖçÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ÂÆ°ÊâπÁ≠ñÁï•:"/>
                <ComboBox x:Name="StrategyComboBox" Margin="0,0,0,10">
                    <ComboBoxItem Content="‰∏≤Ë°åÂÆ°Êâπ" Tag="Sequential"/>
                    <ComboBoxItem Content="Âπ∂Ë°åÂÆ°Êâπ" Tag="Parallel"/>
                    <ComboBoxItem Content="ÊäïÁ•®ÂÆ°Êâπ" Tag="Voting"/>
                    <ComboBoxItem Content="Á¨¨‰∏Ä‰∫∫ÂÆ°Êâπ" Tag="FirstApproval"/>
                </ComboBox>

                <Label Content="ÂÆ°Êâπ‰∫∫ÂàóË°®:"/>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="100"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBox x:Name="ApproverTextBox" Width="150" Margin="0,0,5,0"/>
                        <Button x:Name="AddApproverButton" Content="Ê∑ªÂä†" Width="50"/>
                    </StackPanel>
                    
                    <ListBox x:Name="ApproversListBox" Grid.Row="1" BorderThickness="1" BorderBrush="Gray"/>
                    
                    <Button x:Name="RemoveApproverButton" Grid.Row="2" Content="Âà†Èô§ÈÄâ‰∏≠" 
                            HorizontalAlignment="Left" Margin="0,5,0,0"/>
                </Grid>

                <Label Content="ÊâÄÈúÄÂÆ°ÊâπÊï∞Èáè:" Margin="0,10,0,0"/>
                <TextBox x:Name="RequiredApprovalsTextBox"/>
            </StackPanel>
        </GroupBox>

        <!-- Ë∂ÖÊó∂ËÆæÁΩÆ -->
        <GroupBox Header="Ë∂ÖÊó∂ËÆæÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="Ë∂ÖÊó∂Êó∂Èó¥(Â∞èÊó∂):"/>
                <TextBox x:Name="TimeoutDurationTextBox" Margin="0,0,0,10"/>

                <Label Content="Ë∂ÖÊó∂Âä®‰Ωú:"/>
                <ComboBox x:Name="TimeoutActionComboBox">
                    <ComboBoxItem Content="Ëá™Âä®ÈÄöËøá" Tag="AutoApprove"/>
                    <ComboBoxItem Content="Ëá™Âä®ÊãíÁªù" Tag="AutoReject"/>
                    <ComboBoxItem Content="ÂçáÁ∫ßÂ§ÑÁêÜ" Tag="Escalate"/>
                    <ComboBoxItem Content="ÈáçÊñ∞ÂàÜÈÖç" Tag="Reassign"/>
                </ComboBox>
            </StackPanel>
        </GroupBox>
    </StackPanel>
</UserControl>

<!-- ==================== Âà§Êñ≠ËäÇÁÇπÂ±ûÊÄßÈù¢Êùø ==================== -->
<!-- Views/Properties/DecisionNodePropertyView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.Properties.DecisionNodePropertyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel Margin="10">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <GroupBox Header="Âü∫Êú¨‰ø°ÊÅØ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËäÇÁÇπÂêçÁß∞:"/>
                <TextBox x:Name="DisplayNameTextBox" Margin="0,0,0,10"/>
                
                <Label Content="ÊèèËø∞:"/>
                <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>

        <!-- Êù°‰ª∂ÈÖçÁΩÆ -->
        <GroupBox Header="Âà§Êñ≠Êù°‰ª∂" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ÈÄªËæëËøêÁÆóÁ¨¶:"/>
                <ComboBox x:Name="LogicalOperatorComboBox" Margin="0,0,0,10">
                    <ComboBoxItem Content="Âπ∂‰∏î(AND)" Tag="And"/>
                    <ComboBoxItem Content="ÊàñËÄÖ(OR)" Tag="Or"/>
                </ComboBox>

                <Label Content="Êù°‰ª∂ÂàóË°®:"/>
                <DataGrid x:Name="ConditionsDataGrid" Height="200" AutoGenerateColumns="False"
                          CanUserAddRows="True" CanUserDeleteRows="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Â≠óÊÆµÂêç" Binding="{Binding FieldName}" Width="100"/>
                        <DataGridComboBoxColumn Header="Êìç‰ΩúÁ¨¶" SelectedValueBinding="{Binding Operator}" Width="80">
                            <DataGridComboBoxColumn.ElementStyle>
                                <Style TargetType="ComboBox">
                                    <Setter Property="ItemsSource">
                                        <Setter.Value>
                                            <x:Array Type="sys:String" xmlns:sys="clr-namespace:System;assembly=mscorlib">
                                                <sys:String>Á≠â‰∫é</sys:String>
                                                <sys:String>‰∏çÁ≠â‰∫é</sys:String>
                                                <sys:String>Â§ß‰∫é</sys:String>
                                                <sys:String>Â§ß‰∫éÁ≠â‰∫é</sys:String>
                                                <sys:String>Â∞è‰∫é</sys:String>
                                                <sys:String>Â∞è‰∫éÁ≠â‰∫é</sys:String>
                                                <sys:String>ÂåÖÂê´</sys:String>
                                            </x:Array>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </DataGridComboBoxColumn.ElementStyle>
                        </DataGridComboBoxColumn>
                        <DataGridTextColumn Header="ÂÄº" Binding="{Binding Value}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </GroupBox>
    </StackPanel>
</UserControl>

<!-- ==================== ‰ªªÂä°ËäÇÁÇπÂ±ûÊÄßÈù¢Êùø ==================== -->
<!-- Views/Properties/TaskNodePropertyView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.Properties.TaskNodePropertyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel Margin="10">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <GroupBox Header="Âü∫Êú¨‰ø°ÊÅØ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËäÇÁÇπÂêçÁß∞:"/>
                <TextBox x:Name="DisplayNameTextBox" Margin="0,0,0,10"/>
                
                <Label Content="ÊèèËø∞:"/>
                <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>

        <!-- ‰ªªÂä°ÈÖçÁΩÆ -->
        <GroupBox Header="‰ªªÂä°ÈÖçÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="‰ªªÂä°Á±ªÂûã:"/>
                <ComboBox x:Name="TaskTypeComboBox" Margin="0,0,0,10">
                    <ComboBoxItem Content="‰∫∫Â∑•‰ªªÂä°" Tag="Manual"/>
                    <ComboBoxItem Content="Ëá™Âä®‰ªªÂä°" Tag="Automatic"/>
                </ComboBox>

                <Label Content="ÊâßË°å‰∫∫:"/>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="80"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBox x:Name="AssigneeTextBox" Width="150" Margin="0,0,5,0"/>
                        <Button x:Name="AddAssigneeButton" Content="Ê∑ªÂä†" Width="50"/>
                    </StackPanel>
                    
                    <ListBox x:Name="AssigneesListBox" Grid.Row="1" BorderThickness="1" BorderBrush="Gray"/>
                    
                    <Button x:Name="RemoveAssigneeButton" Grid.Row="2" Content="Âà†Èô§ÈÄâ‰∏≠" 
                            HorizontalAlignment="Left" Margin="0,5,0,0"/>
                </Grid>

                <Label Content="‰ªªÂä°ËØ¥Êòé:" Margin="0,10,0,0"/>
                <TextBox x:Name="InstructionsTextBox" AcceptsReturn="True" Height="80" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>

        <!-- Ë°®ÂçïÈÖçÁΩÆ -->
        <GroupBox Header="Ë°®ÂçïÈÖçÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <Button x:Name="AddFormFieldButton" Content="Ê∑ªÂä†Â≠óÊÆµ" Width="80" Margin="0,0,5,0"/>
                    <Button x:Name="EditFormFieldButton" Content="ÁºñËæëÂ≠óÊÆµ" Width="80" Margin="0,0,5,0"/>
                    <Button x:Name="RemoveFormFieldButton" Content="Âà†Èô§Â≠óÊÆµ" Width="80"/>
                </StackPanel>
                
                <DataGrid x:Name="FormFieldsDataGrid" Height="150" AutoGenerateColumns="False"
                          CanUserAddRows="False" CanUserDeleteRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Â≠óÊÆµÂêç" Binding="{Binding Name}" Width="80"/>
                        <DataGridTextColumn Header="Ê†áÁ≠æ" Binding="{Binding Label}" Width="80"/>
                        <DataGridTextColumn Header="Á±ªÂûã" Binding="{Binding FieldType}" Width="60"/>
                        <DataGridCheckBoxColumn Header="ÂøÖÂ°´" Binding="{Binding IsRequired}" Width="40"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </GroupBox>
    </StackPanel>
</UserControl>

<!-- ==================== ÈÄöÁü•ËäÇÁÇπÂ±ûÊÄßÈù¢Êùø ==================== -->
<!-- Views/Properties/NotificationNodePropertyView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.Properties.NotificationNodePropertyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel Margin="10">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <GroupBox Header="Âü∫Êú¨‰ø°ÊÅØ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËäÇÁÇπÂêçÁß∞:"/>
                <TextBox x:Name="DisplayNameTextBox" Margin="0,0,0,10"/>
                
                <Label Content="ÊèèËø∞:"/>
                <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>

        <!-- ÈÄöÁü•ÈÖçÁΩÆ -->
        <GroupBox Header="ÈÄöÁü•ÈÖçÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ÈÄöÁü•Á±ªÂûã:"/>
                <ComboBox x:Name="NotificationTypeComboBox" Margin="0,0,0,10">
                    <ComboBoxItem Content="ÈÇÆ‰ª∂" Tag="Email"/>
                    <ComboBoxItem Content="Áü≠‰ø°" Tag="SMS"/>
                    <ComboBoxItem Content="Á≥ªÁªüÊ∂àÊÅØ" Tag="SystemMessage"/>
                    <ComboBoxItem Content="ÂæÆ‰ø°" Tag="WeChat"/>
                    <ComboBoxItem Content="ÈíâÈíâ" Tag="DingTalk"/>
                </ComboBox>

                <Label Content="Êé•Êî∂‰∫∫:"/>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="80"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBox x:Name="RecipientTextBox" Width="150" Margin="0,0,5,0"/>
                        <Button x:Name="AddRecipientButton" Content="Ê∑ªÂä†" Width="50"/>
                    </StackPanel>
                    
                    <ListBox x:Name="RecipientsListBox" Grid.Row="1" BorderThickness="1" BorderBrush="Gray"/>
                    
                    <Button x:Name="RemoveRecipientButton" Grid.Row="2" Content="Âà†Èô§ÈÄâ‰∏≠" 
                            HorizontalAlignment="Left" Margin="0,5,0,0"/>
                </Grid>

                <Label Content="‰∏ªÈ¢ò:" Margin="0,10,0,0"/>
                <TextBox x:Name="SubjectTextBox" Margin="0,0,0,10"/>

                <Label Content="Ê∂àÊÅØÊ®°Êùø:"/>
                <TextBox x:Name="MessageTemplateTextBox" AcceptsReturn="True" Height="100" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>
    </StackPanel>
</UserControl>

<!-- ==================== Â∑•‰ΩúÊµÅÁõëÊéßËßÜÂõæ ==================== -->
<!-- Views/WorkflowMonitorView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.WorkflowMonitorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ÊéßÂà∂ÊåâÈíÆ -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10">
            <Button x:Name="RefreshButton" Content="Âà∑Êñ∞" Width="60" Margin="0,0,5,0"/>
            <Button x:Name="ClearLogButton" Content="Ê∏ÖÁ©∫Êó•Âøó" Width="80"/>
        </StackPanel>

        <!-- ÁõëÊéß‰ø°ÊÅØ -->
        <TabControl Grid.Row="1" Margin="5">
            <TabItem Header="ÊâßË°åÁä∂ÊÄÅ">
                <StackPanel Margin="10">
                    <TextBlock Text="Â∑•‰ΩúÊµÅÁä∂ÊÄÅ:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBlock x:Name="WorkflowStatusText" Margin="0,0,0,10"/>
                    
                    <TextBlock Text="ÂΩìÂâçËäÇÁÇπ:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBlock x:Name="CurrentNodeText" Margin="0,0,0,10"/>
                    
                    <TextBlock Text="ÊâßË°åËøõÂ∫¶:" FontWeight="Bold" Margin="0,0,0,5"/>
                    <ProgressBar x:Name="ExecutionProgressBar" Height="20" Margin="0,0,0,5"/>
                    <TextBlock x:Name="ProgressText" HorizontalAlignment="Center"/>
                </StackPanel>
            </TabItem>
            
            <TabItem Header="ÊâßË°åÊó•Âøó">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TextBox x:Name="ExecutionLogTextBox" IsReadOnly="True" Background="Black" 
                             Foreground="Green" FontFamily="Consolas" FontSize="10"/>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>

<!-- ==================== Ë°®ÂçïÂ≠óÊÆµÁºñËæëÂØπËØùÊ°Ü ==================== -->
<!-- Views/Dialogs/FormFieldEditorDialog.xaml -->
<Window x:Class="WorkflowDesigner.Views.Dialogs.FormFieldEditorDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ë°®ÂçïÂ≠óÊÆµÁºñËæë" Height="400" Width="500" ResizeMode="NoResize"
        WindowStartupLocation="CenterOwner">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Â≠óÊÆµÈÖçÁΩÆ -->
        <StackPanel Grid.Row="0">
            <Label Content="Â≠óÊÆµÂêçÁß∞:"/>
            <TextBox x:Name="FieldNameTextBox" Margin="0,0,0,10"/>

            <Label Content="ÊòæÁ§∫Ê†áÁ≠æ:"/>
            <TextBox x:Name="FieldLabelTextBox" Margin="0,0,0,10"/>

            <Label Content="Â≠óÊÆµÁ±ªÂûã:"/>
            <ComboBox x:Name="FieldTypeComboBox" Margin="0,0,0,10">
                <ComboBoxItem Content="ÊñáÊú¨" Tag="Text"/>
                <ComboBoxItem Content="Êï∞Â≠ó" Tag="Number"/>
                <ComboBoxItem Content="Êó•Êúü" Tag="Date"/>
                <ComboBoxItem Content="Â∏ÉÂ∞î" Tag="Boolean"/>
                <ComboBoxItem Content="‰∏ãÊãâÈÄâÊã©" Tag="Select"/>
                <ComboBoxItem Content="Â§öÈÄâ" Tag="MultiSelect"/>
                <ComboBoxItem Content="ÊñáÊú¨Âüü" Tag="TextArea"/>
                <ComboBoxItem Content="Êñá‰ª∂" Tag="File"/>
            </ComboBox>

            <CheckBox x:Name="IsRequiredCheckBox" Content="ÂøÖÂ°´Â≠óÊÆµ" Margin="0,0,0,10"/>

            <Label Content="ÈªòËÆ§ÂÄº:"/>
            <TextBox x:Name="DefaultValueTextBox" Margin="0,0,0,10"/>

            <Label Content="ÈÄâÈ°πÂàóË°®:" x:Name="OptionsLabel" Visibility="Collapsed"/>
            <TextBox x:Name="OptionsTextBox" AcceptsReturn="True" Height="80" 
                     TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                     Visibility="Collapsed" ToolTip="ÊØèË°å‰∏Ä‰∏™ÈÄâÈ°π"/>
        </StackPanel>

        <!-- ÊåâÈíÆ -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button x:Name="OkButton" Content="Á°ÆÂÆö" Width="80" Height="30" Margin="0,0,10,0" IsDefault="True"/>
            <Button x:Name="CancelButton" Content="ÂèñÊ∂à" Width="80" Height="30" IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>

// ==================== ‰∏ªÁ™óÂè£‰ª£Á†ÅÂêéÂè∞ ====================
// Views/WorkflowDesignerWindow.xaml.cs

using System;
using System.Linq;
using System.Reactive.Disposables;
using System.Reactive.Linq;
using System.Windows;
using System.Windows.Controls;
using WorkflowDesigner.ViewModels;
using ReactiveUI;
using NodeNetwork.Views;

namespace WorkflowDesigner.Views
{
    public partial class WorkflowDesignerWindow : Window, IViewFor<WorkflowDesignerViewModel>
    {
        #region ViewModel
        public static readonly DependencyProperty ViewModelProperty = DependencyProperty.Register(
            nameof(ViewModel), typeof(WorkflowDesignerViewModel), typeof(WorkflowDesignerWindow), 
            new PropertyMetadata(null));

        public WorkflowDesignerViewModel ViewModel
        {
            get => (WorkflowDesignerViewModel)GetValue(ViewModelProperty);
            set => SetValue(ViewModelProperty, value);
        }

        object IViewFor.ViewModel
        {
            get => ViewModel;
            set => ViewModel = (WorkflowDesignerViewModel)value;
        }
        #endregion

        public WorkflowDesignerWindow()
        {
            InitializeComponent();
            ViewModel = new WorkflowDesignerViewModel();

            this.WhenActivated(disposables =>
            {
                // ÁªëÂÆöÁΩëÁªúËßÜÂõæ
                this.OneWayBind(ViewModel, vm => vm.Network, v => v.NetworkView.ViewModel)
                    .DisposeWith(disposables);

                // ÁªëÂÆöËäÇÁÇπÂàóË°®
                this.OneWayBind(ViewModel, vm => vm.NodeList, v => v.NodeListView.ViewModel)
                    .DisposeWith(disposables);

                // ÁªëÂÆöÈù¢ÂåÖÂ±ëÂØºËà™
                this.OneWayBind(ViewModel, vm => vm.NetworkBreadcrumbBar, v => v.BreadcrumbBar.ViewModel)
                    .DisposeWith(disposables);

                // ÁªëÂÆöÂ∑•ÂÖ∑Ê†èÂëΩ‰ª§
                this.BindCommand(ViewModel, vm => vm.NewWorkflow, v => v.NewButton)
                    .DisposeWith(disposables);
                this.BindCommand(ViewModel, vm => vm.SaveWorkflow, v => v.SaveButton)
                    .DisposeWith(disposables);
                this.BindCommand(ViewModel, vm => vm.LoadWorkflow, v => v.LoadButton)
                    .DisposeWith(disposables);
                this.BindCommand(ViewModel, vm => vm.RunWorkflow, v => v.RunButton)
                    .DisposeWith(disposables);
                this.BindCommand(ViewModel, vm => vm.StopWorkflow, v => v.StopButton)
                    .DisposeWith(disposables);
                this.BindCommand(ViewModel, vm => vm.ValidateWorkflow, v => v.ValidateButton)
                    .DisposeWith(disposables);
                this.BindCommand(ViewModel, vm => vm.AutoLayout, v => v.AutoLayoutButton)
                    .DisposeWith(disposables);

                // ÁõëÂê¨ÈÄâ‰∏≠ËäÇÁÇπÂèòÂåñÔºåÊõ¥Êñ∞Â±ûÊÄßÈù¢Êùø
                this.WhenAnyValue(v => v.ViewModel.SelectedNode)
                    .Subscribe(selectedNode =>
                    {
                        UpdatePropertyPanel(selectedNode);
                    })
                    .DisposeWith(disposables);

                // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
                this.WhenAnyValue(v => v.ViewModel.Network)
                    .Where(network => network != null)
                    {
                        network.Nodes.CollectionChanged += (s, e) => UpdateStatusBar();
                        network.Connections.CollectionChanged += (s, e) => UpdateStatusBar();
                        UpdateStatusBar();
                    })
                    .DisposeWith(disposables);
            });
        }

        private void UpdatePropertyPanel(WorkflowNodeViewModel selectedNode)
        {
            if (selectedNode == null)
            {
                PropertyContentPresenter.Content = null;
                return;
            }

            UserControl propertyView = selectedNode.WorkflowNodeType switch
            {
                WorkflowNodeType.Approval => new ApprovalNodePropertyView { DataContext = selectedNode },
                WorkflowNodeType.Decision => new DecisionNodePropertyView { DataContext = selectedNode },
                WorkflowNodeType.Task => new TaskNodePropertyView { DataContext = selectedNode },
                WorkflowNodeType.Notification => new NotificationNodePropertyView { DataContext = selectedNode },
                WorkflowNodeType.DataOperation => new DataOperationNodePropertyView { DataContext = selectedNode },
                _ => new DefaultNodePropertyView { DataContext = selectedNode }
            };

            PropertyContentPresenter.Content = propertyView;
        }

        private void UpdateStatusBar()
        {
            if (ViewModel?.Network == null) return;

            StatusText.Text = "Â∞±Áª™";
            NodeCountText.Text = $"ËäÇÁÇπ: {ViewModel.Network.Nodes.Count}";
            ConnectionCountText.Text = $"ËøûÊé•: {ViewModel.Network.Connections.Count}";
        }
    }
}

// ==================== Â∑•‰ΩúÊµÅËäÇÁÇπËßÜÂõæ‰ª£Á†ÅÂêéÂè∞ ====================
// Views/WorkflowNodeView.xaml.cs

using System;
using System.Reactive.Disposables;
using System.Windows;
using System.Windows.Media;
using ReactiveUI;

namespace WorkflowDesigner.Views
{
    public partial class WorkflowNodeView : UserControl, IViewFor<WorkflowNodeViewModel>
    {
        #region ViewModel
        public static readonly DependencyProperty ViewModelProperty = DependencyProperty.Register(
            nameof(ViewModel), typeof(WorkflowNodeViewModel), typeof(WorkflowNodeView), 
            new PropertyMetadata(null));

        public WorkflowNodeViewModel ViewModel
        {
            get => (WorkflowNodeViewModel)GetValue(ViewModelProperty);
            set => SetValue(ViewModelProperty, value);
        }

        object IViewFor.ViewModel
        {
            get => ViewModel;
            set => ViewModel = (WorkflowNodeViewModel)value;
        }
        #endregion

        public WorkflowNodeView()
        {
            InitializeComponent();

            this.WhenActivated(disposables =>
            {
                NodeView.ViewModel = this.ViewModel;
                Disposable.Create(() => NodeView.ViewModel = null).DisposeWith(disposables);

                // ÁªëÂÆöÊâßË°åÁä∂ÊÄÅÊåáÁ§∫Âô®
                this.OneWayBind(ViewModel, vm => vm.ExecutionStatus, v => v.StatusIndicator.Fill, 
                    ConvertStatusToBrush).DisposeWith(disposables);
            });
        }

        private Brush ConvertStatusToBrush(NodeExecutionStatus status)
        {
            return status switch
            {
                NodeExecutionStatus.Pending => Brushes.Gray,
                NodeExecutionStatus.InProgress => Brushes.Yellow,
                NodeExecutionStatus.Completed => Brushes.Green,
                NodeExecutionStatus.Failed => Brushes.Red,
                NodeExecutionStatus.Timeout => Brushes.Orange,
                NodeExecutionStatus.Skipped => Brushes.LightGray,
                NodeExecutionStatus.Cancelled => Brushes.DarkGray,
                _ => Brushes.Gray
            };
        }
    }
}

// ==================== ÂÆ°ÊâπËäÇÁÇπÂ±ûÊÄßËßÜÂõæ‰ª£Á†ÅÂêéÂè∞ ====================
// Views/Properties/ApprovalNodePropertyView.xaml.cs

using System;
using System.Linq;
using System.Reactive.Disposables;
using System.Windows;
using System.Windows.Controls;
using ReactiveUI;

namespace WorkflowDesigner.Views.Properties
{
    public partial class ApprovalNodePropertyView : UserControl, IViewFor<ApprovalNodeViewModel>
    {
        #region ViewModel
        public static readonly DependencyProperty ViewModelProperty = DependencyProperty.Register(
            nameof(ViewModel), typeof(ApprovalNodeViewModel), typeof(ApprovalNodePropertyView), 
            new PropertyMetadata(null));

        public ApprovalNodeViewModel ViewModel
        {
            get => (ApprovalNodeViewModel)GetValue(ViewModelProperty);
            set => SetValue(ViewModelProperty, value);
        }

        object IViewFor.ViewModel
        {
            get => ViewModel;
            set => ViewModel = (ApprovalNodeViewModel)value;
        }
        #endregion

        public ApprovalNodePropertyView()
        {
            InitializeComponent();

            this.WhenActivated(disposables =>
            {
                // ÁªëÂÆöÂü∫Êú¨‰ø°ÊÅØ
                this.Bind(ViewModel, vm => vm.DisplayName, v => v.DisplayNameTextBox.Text)
                    .DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.Description, v => v.DescriptionTextBox.Text)
                    .DisposeWith(disposables);

                // ÁªëÂÆöÂÆ°ÊâπÁ≠ñÁï•
                this.OneWayBind(ViewModel, vm => vm.Strategy, v => v.StrategyComboBox.SelectedIndex,
                    strategy => (int)strategy).DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.Strategy, v => v.StrategyComboBox.SelectedIndex,
                    index => (ApprovalStrategy)index, strategy => (int)strategy).DisposeWith(disposables);

                // ÁªëÂÆöÂÆ°Êâπ‰∫∫ÂàóË°®
                this.OneWayBind(ViewModel, vm => vm.Approvers, v => v.ApproversListBox.ItemsSource)
                    .DisposeWith(disposables);

                // Ê∑ªÂä†ÂÆ°Êâπ‰∫∫ÊåâÈíÆ‰∫ã‰ª∂
                AddApproverButton.Click += (s, e) =>
                {
                    if (!string.IsNullOrWhiteSpace(ApproverTextBox.Text))
                    {
                        ViewModel.Approvers.Add(ApproverTextBox.Text.Trim());
                        ApproverTextBox.Clear();
                    }
                };

                // Âà†Èô§ÂÆ°Êâπ‰∫∫ÊåâÈíÆ‰∫ã‰ª∂
                RemoveApproverButton.Click += (s, e) =>
                {
                    if (ApproversListBox.SelectedItem is string selectedApprover)
                    {
                        ViewModel.Approvers.Remove(selectedApprover);
                    }
                };

                // ÁªëÂÆöÊâÄÈúÄÂÆ°ÊâπÊï∞Èáè
                this.Bind(ViewModel, vm => vm.RequiredApprovals, v => v.RequiredApprovalsTextBox.Text,
                    count => count.ToString(), text => int.TryParse(text, out var result) ? result : 1)
                    .DisposeWith(disposables);

                // ÁªëÂÆöË∂ÖÊó∂ËÆæÁΩÆ
                this.Bind(ViewModel, vm => vm.TimeoutDuration, v => v.TimeoutDurationTextBox.Text,
                    timespan => timespan?.TotalHours.ToString() ?? "",
                    text => double.TryParse(text, out var hours) ? TimeSpan.FromHours(hours) : (TimeSpan?)null)
                    .DisposeWith(disposables);

                this.OneWayBind(ViewModel, vm => vm.TimeoutAction, v => v.TimeoutActionComboBox.SelectedIndex,
                    action => (int)action).DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.TimeoutAction, v => v.TimeoutActionComboBox.SelectedIndex,
                    index => (TimeoutAction)index, action => (int)action).DisposeWith(disposables);
            });
        }
    }
}

// ==================== Âà§Êñ≠ËäÇÁÇπÂ±ûÊÄßËßÜÂõæ‰ª£Á†ÅÂêéÂè∞ ====================
// Views/Properties/DecisionNodePropertyView.xaml.cs

using System;
using System.Reactive.Disposables;
using System.Windows;
using System.Windows.Controls;
using ReactiveUI;

namespace WorkflowDesigner.Views.Properties
{
    public partial class DecisionNodePropertyView : UserControl, IViewFor<DecisionNodeViewModel>
    {
        #region ViewModel
        public static readonly DependencyProperty ViewModelProperty = DependencyProperty.Register(
            nameof(ViewModel), typeof(DecisionNodeViewModel), typeof(DecisionNodePropertyView), 
            new PropertyMetadata(null));

        public DecisionNodeViewModel ViewModel
        {
            get => (DecisionNodeViewModel)GetValue(ViewModelProperty);
            set => SetValue(ViewModelProperty, value);
        }

        object IViewFor.ViewModel
        {
            get => ViewModel;
            set => ViewModel = (DecisionNodeViewModel)value;
        }
        #endregion

        public DecisionNodePropertyView()
        {
            InitializeComponent();

            this.WhenActivated(disposables =>
            {
                // ÁªëÂÆöÂü∫Êú¨‰ø°ÊÅØ
                this.Bind(ViewModel, vm => vm.DisplayName, v => v.DisplayNameTextBox.Text)
                    .DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.Description, v => v.DescriptionTextBox.Text)
                    .DisposeWith(disposables);

                // ÁªëÂÆöÈÄªËæëËøêÁÆóÁ¨¶
                this.OneWayBind(ViewModel, vm => vm.Operator, v => v.LogicalOperatorComboBox.SelectedIndex,
                    op => (int)op).DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.Operator, v => v.LogicalOperatorComboBox.SelectedIndex,
                    index => (LogicalOperator)index, op => (int)op).DisposeWith(disposables);

                // ÁªëÂÆöÊù°‰ª∂ÂàóË°®
                this.OneWayBind(ViewModel, vm => vm.Conditions, v => v.ConditionsDataGrid.ItemsSource)
                    .DisposeWith(disposables);
            });
        }
    }
}

// ==================== ‰ªªÂä°ËäÇÁÇπÂ±ûÊÄßËßÜÂõæ‰ª£Á†ÅÂêéÂè∞ ====================
// Views/Properties/TaskNodePropertyView.xaml.cs

using System;
using System.Reactive.Disposables;
using System.Windows;
using System.Windows.Controls;
using ReactiveUI;

namespace WorkflowDesigner.Views.Properties
{
    public partial class TaskNodePropertyView : UserControl, IViewFor<TaskNodeViewModel>
    {
        #region ViewModel
        public static readonly DependencyProperty ViewModelProperty = DependencyProperty.Register(
            nameof(ViewModel), typeof(TaskNodeViewModel), typeof(TaskNodePropertyView), 
            new PropertyMetadata(null));

        public TaskNodeViewModel ViewModel
        {
            get => (TaskNodeViewModel)GetValue(ViewModelProperty);
            set => SetValue(ViewModelProperty, value);
        }

        object IViewFor.ViewModel
        {
            get => ViewModel;
            set => ViewModel = (TaskNodeViewModel)value;
        }
        #endregion

        public TaskNodePropertyView()
        {
            InitializeComponent();

            this.WhenActivated(disposables =>
            {
                // ÁªëÂÆöÂü∫Êú¨‰ø°ÊÅØ
                this.Bind(ViewModel, vm => vm.DisplayName, v => v.DisplayNameTextBox.Text)
                    .DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.Description, v => v.DescriptionTextBox.Text)
                    .DisposeWith(disposables);

                // ÁªëÂÆö‰ªªÂä°Á±ªÂûã
                this.OneWayBind(ViewModel, vm => vm.TaskType, v => v.TaskTypeComboBox.SelectedIndex,
                    type => (int)type).DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.TaskType, v => v.TaskTypeComboBox.SelectedIndex,
                    index => (TaskType)index, type => (int)type).DisposeWith(disposables);

                // ÁªëÂÆöÊâßË°å‰∫∫ÂàóË°®
                this.OneWayBind(ViewModel, vm => vm.Assignees, v => v.AssigneesListBox.ItemsSource)
                    .DisposeWith(disposables);

                // Ê∑ªÂä†ÊâßË°å‰∫∫ÊåâÈíÆ‰∫ã‰ª∂
                AddAssigneeButton.Click += (s, e) =>
                {
                    if (!string.IsNullOrWhiteSpace(AssigneeTextBox.Text))
                    {
                        ViewModel.Assignees.Add(AssigneeTextBox.Text.Trim());
                        AssigneeTextBox.Clear();
                    }
                };

                // Âà†Èô§ÊâßË°å‰∫∫ÊåâÈíÆ‰∫ã‰ª∂
                RemoveAssigneeButton.Click += (s, e) =>
                {
                    if (AssigneesListBox.SelectedItem is string selectedAssignee)
                    {
                        ViewModel.Assignees.Remove(selectedAssignee);
                    }
                };

                // ÁªëÂÆö‰ªªÂä°ËØ¥Êòé
                this.Bind(ViewModel, vm => vm.Instructions, v => v.InstructionsTextBox.Text)
                    .DisposeWith(disposables);

                // ÁªëÂÆöË°®ÂçïÂ≠óÊÆµÂàóË°®
                this.OneWayBind(ViewModel, vm => vm.FormFields, v => v.FormFieldsDataGrid.ItemsSource)
                    .DisposeWith(disposables);

                // Ë°®ÂçïÂ≠óÊÆµÊìç‰Ωú‰∫ã‰ª∂
                AddFormFieldButton.Click += (s, e) =>
                {
                    var dialog = new FormFieldEditorDialog();
                    if (dialog.ShowDialog() == true)
                    {
                        ViewModel.FormFields.Add(dialog.FormField);
                    }
                };

                EditFormFieldButton.Click += (s, e) =>
                {
                    if (FormFieldsDataGrid.SelectedItem is FormField selectedField)
                    {
                        var dialog = new FormFieldEditorDialog(selectedField);
                        if (dialog.ShowDialog() == true)
                        {
                            // Â≠óÊÆµÂ∑≤Âú®ÂØπËØùÊ°Ü‰∏≠Áõ¥Êé•ÁºñËæë
                        }
                    }
                };

                RemoveFormFieldButton.Click += (s, e) =>
                {
                    if (FormFieldsDataGrid.SelectedItem is FormField selectedField)
                    {
                        ViewModel.FormFields.Remove(selectedField);
                    }
                };
            });
        }
    }
}

// ==================== ÈÄöÁü•ËäÇÁÇπÂ±ûÊÄßËßÜÂõæ‰ª£Á†ÅÂêéÂè∞ ====================
// Views/Properties/NotificationNodePropertyView.xaml.cs

using System;
using System.Reactive.Disposables;
using System.Windows;
using System.Windows.Controls;
using ReactiveUI;

namespace WorkflowDesigner.Views.Properties
{
    public partial class NotificationNodePropertyView : UserControl, IViewFor<NotificationNodeViewModel>
    {
        #region ViewModel
        public static readonly DependencyProperty ViewModelProperty = DependencyProperty.Register(
            nameof(ViewModel), typeof(NotificationNodeViewModel), typeof(NotificationNodePropertyView), 
            new PropertyMetadata(null));

        public NotificationNodeViewModel ViewModel
        {
            get => (NotificationNodeViewModel)GetValue(ViewModelProperty);
            set => SetValue(ViewModelProperty, value);
        }

        object IViewFor.ViewModel
        {
            get => ViewModel;
            set => ViewModel = (NotificationNodeViewModel)value;
        }
        #endregion

        public NotificationNodePropertyView()
        {
            InitializeComponent();

            this.WhenActivated(disposables =>
            {
                // ÁªëÂÆöÂü∫Êú¨‰ø°ÊÅØ
                this.Bind(ViewModel, vm => vm.DisplayName, v => v.DisplayNameTextBox.Text)
                    .DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.Description, v => v.DescriptionTextBox.Text)
                    .DisposeWith(disposables);

                // ÁªëÂÆöÈÄöÁü•Á±ªÂûã
                this.OneWayBind(ViewModel, vm => vm.NotificationType, v => v.NotificationTypeComboBox.SelectedIndex,
                    type => (int)type).DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.NotificationType, v => v.NotificationTypeComboBox.SelectedIndex,
                    index => (NotificationType)index, type => (int)type).DisposeWith(disposables);

                // ÁªëÂÆöÊé•Êî∂‰∫∫ÂàóË°®
                this.OneWayBind(ViewModel, vm => vm.Recipients, v => v.RecipientsListBox.ItemsSource)
                    .DisposeWith(disposables);

                // Ê∑ªÂä†Êé•Êî∂‰∫∫ÊåâÈíÆ‰∫ã‰ª∂
                AddRecipientButton.Click += (s, e) =>
                {
                    if (!string.IsNullOrWhiteSpace(RecipientTextBox.Text))
                    {
                        ViewModel.Recipients.Add(RecipientTextBox.Text.Trim());
                        RecipientTextBox.Clear();
                    }
                };

                // Âà†Èô§Êé•Êî∂‰∫∫ÊåâÈíÆ‰∫ã‰ª∂
                RemoveRecipientButton.Click += (s, e) =>
                {
                    if (RecipientsListBox.SelectedItem is string selectedRecipient)
                    {
                        ViewModel.Recipients.Remove(selectedRecipient);
                    }
                };

                // ÁªëÂÆö‰∏ªÈ¢òÂíåÊ∂àÊÅØÊ®°Êùø
                this.Bind(ViewModel, vm => vm.Subject, v => v.SubjectTextBox.Text)
                    .DisposeWith(disposables);
                this.Bind(ViewModel, vm => vm.MessageTemplate, v => v.MessageTemplateTextBox.Text)
                    .DisposeWith(disposables);
            });
        }
    }
}

// ==================== Â∑•‰ΩúÊµÅÁõëÊéßËßÜÂõæ‰ª£Á†ÅÂêéÂè∞ ====================
// Views/WorkflowMonitorView.xaml.cs

using System;
using System.Reactive.Disposables;
using System.Windows;
using System.Windows.Controls;
using ReactiveUI;

namespace WorkflowDesigner.Views
{
    public partial class WorkflowMonitorView : UserControl, IViewFor<WorkflowEngineViewModel>
    {
        #region ViewModel
        public static readonly DependencyProperty ViewModelProperty = DependencyProperty.Register(
            nameof(ViewModel), typeof(WorkflowEngineViewModel), typeof(WorkflowMonitorView), 
            new PropertyMetadata(null));

        public WorkflowEngineViewModel ViewModel
        {
            get => (WorkflowEngineViewModel)GetValue(ViewModelProperty);
            set => SetValue(ViewModelProperty, value);
        }

        object IViewFor.ViewModel
        {
            get => ViewModel;
            set => ViewModel = (WorkflowEngineViewModel)value;
        }
        #endregion

        public WorkflowMonitorView()
        {
            InitializeComponent();

            this.WhenActivated(disposables =>
            {
                // ÁªëÂÆöÂ∑•‰ΩúÊµÅÁä∂ÊÄÅ
                this.OneWayBind(ViewModel, vm => vm.CurrentInstance.Status, v => v.WorkflowStatusText.Text,
                    status => status.ToString()).DisposeWith(disposables);

                // ÁªëÂÆöÂΩìÂâçËäÇÁÇπ
                this.OneWayBind(ViewModel, vm => vm.CurrentInstance, v => v.CurrentNodeText.Text,
                    instance => GetCurrentNodeName(instance)).DisposeWith(disposables);

                // ÊåâÈíÆ‰∫ã‰ª∂
                RefreshButton.Click += (s, e) => RefreshStatus();
                ClearLogButton.Click += (s, e) => ExecutionLogTextBox.Clear();
            });
        }

        private string GetCurrentNodeName(WorkflowInstance instance)
        {
            if (instance?.NodeExecutions == null) return "Êó†";
            
            var currentNode = instance.NodeExecutions
                .Where(ne => ne.Status == NodeExecutionStatus.InProgress)
                .FirstOrDefault();
            
            return currentNode?.NodeId ?? "Êó†";
        }

        private void RefreshStatus()
        {
            // Âà∑Êñ∞Â∑•‰ΩúÊµÅÁä∂ÊÄÅÈÄªËæë
            if (ViewModel?.CurrentInstance != null)
            {
                var progress = CalculateProgress(ViewModel.CurrentInstance);
                ExecutionProgressBar.Value = progress;
                ProgressText.Text = $"{progress:P0}";
            }
        }

        private double CalculateProgress(WorkflowInstance instance)
        {
            if (instance?.NodeExecutions == null || !instance.NodeExecutions.Any())
                return 0.0;

            var completedCount = instance.NodeExecutions.Count(ne => 
                ne.Status == NodeExecutionStatus.Completed || 
                ne.Status == NodeExecutionStatus.Skipped);
            
            return (double)completedCount / instance.NodeExecutions.Count;
        }
    }
}

// ==================== Ë°®ÂçïÂ≠óÊÆµÁºñËæëÂØπËØùÊ°Ü‰ª£Á†ÅÂêéÂè∞ ====================
// Views/Dialogs/FormFieldEditorDialog.xaml.cs

using System;
using System.Linq;
using System.Windows;
using System.Windows.Controls;

namespace WorkflowDesigner.Views.Dialogs
{
    public partial class FormFieldEditorDialog : Window
    {
        public FormField FormField { get; private set; }

        public FormFieldEditorDialog() : this(new FormField())
        {
        }

        public FormFieldEditorDialog(FormField formField)
        {
            InitializeComponent();
            FormField = formField ?? new FormField();
            LoadFormField();
            
            // Â≠óÊÆµÁ±ªÂûãÊîπÂèòÊó∂ÊòæÁ§∫/ÈöêËóèÈÄâÈ°πÂàóË°®
            FieldTypeComboBox.SelectionChanged += (s, e) =>
            {
                var selectedType = GetSelectedFieldType();
                var showOptions = selectedType == FormFieldType.Select || selectedType == FormFieldType.MultiSelect;
                
                OptionsLabel.Visibility = showOptions ? Visibility.Visible : Visibility.Collapsed;
                OptionsTextBox.Visibility = showOptions ? Visibility.Visible : Visibility.Collapsed;
            };

            OkButton.Click += (s, e) =>
            {
                if (ValidateAndSaveFormField())
                {
                    DialogResult = true;
                    Close();
                }
            };

            CancelButton.Click += (s, e) =>
            {
                DialogResult = false;
                Close();
            };
        }

        private void LoadFormField()
        {
            FieldNameTextBox.Text = FormField.Name;
            FieldLabelTextBox.Text = FormField.Label;
            FieldTypeComboBox.SelectedIndex = (int)FormField.FieldType;
            IsRequiredCheckBox.IsChecked = FormField.IsRequired;
            DefaultValueTextBox.Text = FormField.DefaultValue?.ToString() ?? "";
            OptionsTextBox.Text = string.Join("\n", FormField.Options);
        }

        private bool ValidateAndSaveFormField()
        {
            if (string.IsNullOrWhiteSpace(FieldNameTextBox.Text))
            {
                MessageBox.Show("Â≠óÊÆµÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫", "È™åËØÅÈîôËØØ", MessageBoxButton.OK, MessageBoxImage.Warning);
                return false;
            }

            if (string.IsNullOrWhiteSpace(FieldLabelTextBox.Text))
            {
                MessageBox.Show("ÊòæÁ§∫Ê†áÁ≠æ‰∏çËÉΩ‰∏∫Á©∫", "È™åËØÅÈîôËØØ", MessageBoxButton.OK, MessageBoxImage.Warning);
                return false;
            }

            // ‰øùÂ≠òË°®ÂçïÂ≠óÊÆµ
            FormField.Name = FieldNameTextBox.Text.Trim();
            FormField.Label = FieldLabelTextBox.Text.Trim();
            FormField.FieldType = GetSelectedFieldType();
            FormField.IsRequired = IsRequiredCheckBox.IsChecked ?? false;
            FormField.DefaultValue = DefaultValueTextBox.Text;

            // ‰øùÂ≠òÈÄâÈ°πÂàóË°®
            FormField.Options.Clear();
            if (!string.IsNullOrWhiteSpace(OptionsTextBox.Text))
            {
                var options = OptionsTextBox.Text.Split('\n')
                    .Select(o => o.Trim())
                    .Where(o => !string.IsNullOrEmpty(o));
                
                foreach (var option in options)
                {
                    FormField.Options.Add(option);
                }
            }

            return true;
        }

        private FormFieldType GetSelectedFieldType()
        {
            return FieldTypeComboBox.SelectedIndex >= 0 
                ? (FormFieldType)FieldTypeComboBox.SelectedIndex 
                : FormFieldType.Text;
        }
    }
}

// ==================== ÈªòËÆ§ËäÇÁÇπÂ±ûÊÄßËßÜÂõæ ====================
// Views/Properties/DefaultNodePropertyView.xaml.cs

using System;
using System.Reactive.Disposables;
using System.Windows;
using System.Windows.Controls;
using ReactiveUI;

namespace WorkflowDesigner.Views.Properties
{
    public partial class DefaultNodePropertyView : UserControl, IViewFor<WorkflowNodeViewModel>
    {
        #region ViewModel
        public static readonly DependencyProperty ViewModelProperty = DependencyProperty.Register(
            nameof(ViewModel), typeof(WorkflowNodeViewModel), typeof(DefaultNodePropertyView), 
            new PropertyMetadata(null));

        public WorkflowNodeViewModel ViewModel
        {
            get => (WorkflowNodeViewModel)GetValue(ViewModelProperty);
            set => SetValue(ViewModelProperty, value);
        }

        object IViewFor.ViewModel
        {
            get => ViewModel;
            set => ViewModel = (WorkflowNodeViewModel)value;
        }
        #endregion

        public DefaultNodePropertyView()
        {
            InitializeComponent();

            this.WhenActivated(disposables =>
            {
                // ÁªëÂÆöÂü∫Êú¨Â±ûÊÄß
                if (ViewModel != null)
                {
                    this.Bind(ViewModel, vm => vm.DisplayName, v => v.DisplayNameTextBox.Text)
                        .DisposeWith(disposables);
                    this.Bind(ViewModel, vm => vm.Description, v => v.DescriptionTextBox.Text)
                        .DisposeWith(disposables);
                }
            });
        }
    }
}

<!-- ==================== ÈªòËÆ§ËäÇÁÇπÂ±ûÊÄßËßÜÂõæ ==================== -->
<!-- Views/Properties/DefaultNodePropertyView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.Properties.DefaultNodePropertyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel Margin="10">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <GroupBox Header="Âü∫Êú¨‰ø°ÊÅØ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËäÇÁÇπÂêçÁß∞:"/>
                <TextBox x:Name="DisplayNameTextBox" Margin="0,0,0,10"/>
                
                <Label Content="ÊèèËø∞:"/>
                <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>

                <Label Content="ËäÇÁÇπÁ±ªÂûã:" Margin="0,10,0,0"/>
                <TextBox x:Name="NodeTypeTextBox" IsReadOnly="True" Background="#F0F0F0"/>
            </StackPanel>
        </GroupBox>

        <!-- ÊâßË°åÁä∂ÊÄÅ -->
        <GroupBox Header="ÊâßË°åÁä∂ÊÄÅ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ÂΩìÂâçÁä∂ÊÄÅ:"/>
                <TextBox x:Name="ExecutionStatusTextBox" IsReadOnly="True" Background="#F0F0F0" Margin="0,0,0,10"/>
                
                <Label Content="ËäÇÁÇπID:"/>
                <TextBox x:Name="NodeIdTextBox" IsReadOnly="True" Background="#F0F0F0"/>
            </StackPanel>
        </GroupBox>
    </StackPanel>
</UserControl>

<!-- ==================== Êï∞ÊçÆÊìç‰ΩúËäÇÁÇπÂ±ûÊÄßËßÜÂõæ ==================== -->
<!-- Views/Properties/DataOperationNodePropertyView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.Properties.DataOperationNodePropertyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel Margin="10">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <GroupBox Header="Âü∫Êú¨‰ø°ÊÅØ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËäÇÁÇπÂêçÁß∞:"/>
                <TextBox x:Name="DisplayNameTextBox" Margin="0,0,0,10"/>
                
                <Label Content="ÊèèËø∞:"/>
                <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>

        <!-- Êï∞ÊçÆÊìç‰ΩúÈÖçÁΩÆ -->
        <GroupBox Header="Êï∞ÊçÆÊìç‰ΩúÈÖçÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="Êìç‰ΩúÁ±ªÂûã:"/>
                <ComboBox x:Name="OperationComboBox" Margin="0,0,0,10">
                    <ComboBoxItem Content="ÂàõÂª∫(Create)" Tag="Create"/>
                    <ComboBoxItem Content="ËØªÂèñ(Read)" Tag="Read"/>
                    <ComboBoxItem Content="Êõ¥Êñ∞(Update)" Tag="Update"/>
                    <ComboBoxItem Content="Âà†Èô§(Delete)" Tag="Delete"/>
                </ComboBox>

                <Label Content="Êï∞ÊçÆÊ∫ê:"/>
                <ComboBox x:Name="DataSourceComboBox" IsEditable="True" Margin="0,0,0,10">
                    <ComboBoxItem Content="Êï∞ÊçÆÂ∫ìË°®"/>
                    <ComboBoxItem Content="Web API"/>
                    <ComboBoxItem Content="Êñá‰ª∂Á≥ªÁªü"/>
                    <ComboBoxItem Content="Ê∂àÊÅØÈòüÂàó"/>
                </ComboBox>

                <Label Content="ËøûÊé•Â≠óÁ¨¶‰∏≤/URL:"/>
                <TextBox x:Name="ConnectionStringTextBox" Margin="0,0,0,10"/>

                <Label Content="SQLÊü•ËØ¢/ËÑöÊú¨:"/>
                <TextBox x:Name="SqlQueryTextBox" AcceptsReturn="True" Height="100" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" 
                         FontFamily="Consolas" FontSize="10"/>
            </StackPanel>
        </GroupBox>

        <!-- ÂèÇÊï∞ÈÖçÁΩÆ -->
        <GroupBox Header="ÂèÇÊï∞ÈÖçÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                    <Button x:Name="AddParameterButton" Content="Ê∑ªÂä†ÂèÇÊï∞" Width="80" Margin="0,0,5,0"/>
                    <Button x:Name="EditParameterButton" Content="ÁºñËæëÂèÇÊï∞" Width="80" Margin="0,0,5,0"/>
                    <Button x:Name="RemoveParameterButton" Content="Âà†Èô§ÂèÇÊï∞" Width="80"/>
                </StackPanel>
                
                <DataGrid x:Name="ParametersDataGrid" Height="120" AutoGenerateColumns="False"
                          CanUserAddRows="False" CanUserDeleteRows="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ÂèÇÊï∞Âêç" Binding="{Binding Name}" Width="100"/>
                        <DataGridTextColumn Header="Á±ªÂûã" Binding="{Binding ParameterType.Name}" Width="80"/>
                        <DataGridTextColumn Header="ÂÄº" Binding="{Binding Value}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </GroupBox>

        <!-- ËæìÂá∫Êò†Â∞Ñ -->
        <GroupBox Header="ËæìÂá∫Êò†Â∞Ñ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ÁªìÊûúÂèòÈáèÂêç:"/>
                <TextBox x:Name="ResultVariableTextBox" Margin="0,0,0,10"/>
                
                <CheckBox x:Name="LogExecutionCheckBox" Content="ËÆ∞ÂΩïÊâßË°åÊó•Âøó" IsChecked="True"/>
            </StackPanel>
        </GroupBox>
    </StackPanel>
</UserControl>

<!-- ==================== ÂºÄÂßãËäÇÁÇπÂ±ûÊÄßËßÜÂõæ ==================== -->
<!-- Views/Properties/StartNodePropertyView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.Properties.StartNodePropertyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel Margin="10">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <GroupBox Header="Âü∫Êú¨‰ø°ÊÅØ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËäÇÁÇπÂêçÁß∞:"/>
                <TextBox x:Name="DisplayNameTextBox" Margin="0,0,0,10"/>
                
                <Label Content="ÊèèËø∞:"/>
                <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>

        <!-- ÂêØÂä®ÈÖçÁΩÆ -->
        <GroupBox Header="ÂêØÂä®ÈÖçÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="Ëß¶ÂèëÊñπÂºè:"/>
                <ComboBox x:Name="TriggerTypeComboBox" Margin="0,0,0,10">
                    <ComboBoxItem Content="ÊâãÂä®ÂêØÂä®" Tag="Manual"/>
                    <ComboBoxItem Content="ÂÆöÊó∂ÂêØÂä®" Tag="Timer"/>
                    <ComboBoxItem Content="‰∫ã‰ª∂Ëß¶Âèë" Tag="Event"/>
                    <ComboBoxItem Content="APIË∞ÉÁî®" Tag="Api"/>
                </ComboBox>

                <Label Content="ÂêØÂä®Êù°‰ª∂:"/>
                <TextBox x:Name="StartConditionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>

                <Label Content="ÂàùÂßãÂèòÈáè:" Margin="0,10,0,0"/>
                <DataGrid x:Name="InitialVariablesDataGrid" Height="100" AutoGenerateColumns="False"
                          CanUserAddRows="True" CanUserDeleteRows="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ÂèòÈáèÂêç" Binding="{Binding Name}" Width="100"/>
                        <DataGridTextColumn Header="Á±ªÂûã" Binding="{Binding Type}" Width="80"/>
                        <DataGridTextColumn Header="ÈªòËÆ§ÂÄº" Binding="{Binding DefaultValue}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </GroupBox>
    </StackPanel>
</UserControl>

<!-- ==================== ÁªìÊùüËäÇÁÇπÂ±ûÊÄßËßÜÂõæ ==================== -->
<!-- Views/Properties/EndNodePropertyView.xaml -->
<UserControl x:Class="WorkflowDesigner.Views.Properties.EndNodePropertyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <StackPanel Margin="10">
        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
        <GroupBox Header="Âü∫Êú¨‰ø°ÊÅØ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËäÇÁÇπÂêçÁß∞:"/>
                <TextBox x:Name="DisplayNameTextBox" Margin="0,0,0,10"/>
                
                <Label Content="ÊèèËø∞:"/>
                <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </StackPanel>
        </GroupBox>

        <!-- ÁªìÊùüÈÖçÁΩÆ -->
        <GroupBox Header="ÁªìÊùüÈÖçÁΩÆ" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ÁªìÊùüÁ±ªÂûã:"/>
                <ComboBox x:Name="EndTypeComboBox" Margin="0,0,0,10">
                    <ComboBoxItem Content="Ê≠£Â∏∏ÁªìÊùü" Tag="Normal"/>
                    <ComboBoxItem Content="ÂºÇÂ∏∏ÁªìÊùü" Tag="Error"/>
                    <ComboBoxItem Content="ÂèñÊ∂àÁªìÊùü" Tag="Cancelled"/>
                </ComboBox>

                <Label Content="ÁªìÊùüÊ∂àÊÅØ:"/>
                <TextBox x:Name="EndMessageTextBox" AcceptsReturn="True" Height="60" 
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>

                <CheckBox x:Name="SendNotificationCheckBox" Content="ÂèëÈÄÅÁªìÊùüÈÄöÁü•" Margin="0,10,0,0"/>
                
                <Label Content="ÈÄöÁü•Êé•Êî∂‰∫∫:" Margin="0,10,0,0"/>
                <TextBox x:Name="NotificationRecipientsTextBox" Height="40" 
                         AcceptsReturn="True" TextWrapping="Wrap" 
                         ToolTip="Â§ö‰∏™Êé•Êî∂‰∫∫Áî®ÂàÜÂè∑ÂàÜÈöî"/>
            </StackPanel>
        </GroupBox>

        <!-- ËæìÂá∫ÁªìÊûú -->
        <GroupBox Header="ËæìÂá∫ÁªìÊûú" Margin="0,0,0,10">
            <StackPanel Margin="10">
                <Label Content="ËæìÂá∫ÂèòÈáè:"/>
                <DataGrid x:Name="OutputVariablesDataGrid" Height="100" AutoGenerateColumns="False"
                          CanUserAddRows="True" CanUserDeleteRows="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="ÂèòÈáèÂêç" Binding="{Binding Name}" Width="100"/>
                        <DataGridTextColumn Header="Á±ªÂûã" Binding="{Binding Type}" Width="80"/>
                        <DataGridTextColumn Header="ÂÄºË°®ËææÂºè" Binding="{Binding Expression}" Width="*"/>
                    </DataGrid.Columns>
                </DataGrid>
            </StackPanel>
        </GroupBox>
    </StackPanel>
</UserControl>

<!-- ==================== Â∑•‰ΩúÊµÅÈ™åËØÅÁªìÊûúÂØπËØùÊ°Ü ==================== -->
<!-- Views/Dialogs/ValidationResultDialog.xaml -->
<Window x:Class="WorkflowDesigner.Views.Dialogs.ValidationResultDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Â∑•‰ΩúÊµÅÈ™åËØÅÁªìÊûú" Height="500" Width="600" ResizeMode="CanResize"
        WindowStartupLocation="CenterOwner">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- È™åËØÅÁªìÊûúÊëòË¶Å -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock x:Name="ValidationSummaryText" FontSize="14" FontWeight="Bold"/>
        </StackPanel>

        <!-- ËØ¶ÁªÜ‰ø°ÊÅØ -->
        <TabControl Grid.Row="1">
            <TabItem Header="ÈîôËØØ" x:Name="ErrorsTab">
                <ListBox x:Name="ErrorsListBox" BorderThickness="1" BorderBrush="Red">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <TextBlock Text="‚ùå" FontSize="16" Margin="0,0,10,0"/>
                                <TextBlock Text="{Binding}" TextWrapping="Wrap"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </TabItem>
            
            <TabItem Header="Ë≠¶Âëä" x:Name="WarningsTab">
                <ListBox x:Name="WarningsListBox" BorderThickness="1" BorderBrush="Orange">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="5">
                                <TextBlock Text="‚ö†Ô∏è" FontSize="16" Margin="0,0,10,0"/>
                                <TextBlock Text="{Binding}" TextWrapping="Wrap"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </TabItem>
            
            <TabItem Header="Âª∫ËÆÆ">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TextBlock x:Name="SuggestionsText" Margin="10" TextWrapping="Wrap">
                        <Run Text="Âª∫ËÆÆ:"/>
                        <LineBreak/>
                        <Run Text="‚Ä¢ Á°Æ‰øùÊØè‰∏™Â∑•‰ΩúÊµÅÈÉΩÊúâÊòéÁ°ÆÁöÑÂºÄÂßãÂíåÁªìÊùüËäÇÁÇπ"/>
                        <LineBreak/>
                        <Run Text="‚Ä¢ ‰∏∫ÂÆ°ÊâπËäÇÁÇπÈÖçÁΩÆÂêàÈÄÇÁöÑÂÆ°Êâπ‰∫∫ÂíåË∂ÖÊó∂ËÆæÁΩÆ"/>
                        <LineBreak/>
                        <Run Text="‚Ä¢ Âà§Êñ≠ËäÇÁÇπÂ∫îËØ•ÊúâÊòéÁ°ÆÁöÑÊù°‰ª∂Ë°®ËææÂºè"/>
                        <LineBreak/>
                        <Run Text="‚Ä¢ ÈÄöÁü•ËäÇÁÇπÂ∫îËØ•ÈÖçÁΩÆÊé•Êî∂‰∫∫ÂíåÊ∂àÊÅØÊ®°Êùø"/>
                        <LineBreak/>
                        <Run Text="‚Ä¢ ‰ΩøÁî®ÊúâÊÑè‰πâÁöÑËäÇÁÇπÂêçÁß∞‰ª•ÊèêÈ´òÂèØËØªÊÄß"/>
                        <LineBreak/>
                        <Run Text="‚Ä¢ ÈÅøÂÖçÂàõÂª∫Êó†Ê≥ïÂà∞ËææÁöÑËäÇÁÇπ"/>
                        <LineBreak/>
                        <Run Text="‚Ä¢ Á°Æ‰øùÊâÄÊúâÂøÖÈúÄÁöÑËøûÊé•ÈÉΩÂ∑≤Âª∫Á´ã"/>
                    </TextBlock>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- ÊåâÈíÆ -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button x:Name="ExportButton" Content="ÂØºÂá∫Êä•Âëä" Width="80" Height="30" Margin="0,0,10,0"/>
            <Button x:Name="CloseButton" Content="ÂÖ≥Èó≠" Width="80" Height="30" IsDefault="True"/>
        </StackPanel>
    </Grid>
</Window>

<!-- ==================== Â∑•‰ΩúÊµÅËÆæÁΩÆÂØπËØùÊ°Ü ==================== -->
<!-- Views/Dialogs/WorkflowSettingsDialog.xaml -->
<Window x:Class="WorkflowDesigner.Views.Dialogs.WorkflowSettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Â∑•‰ΩúÊµÅËÆæÁΩÆ" Height="600" Width="500" ResizeMode="CanResize"
        WindowStartupLocation="CenterOwner">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ËÆæÁΩÆÈÄâÈ°πÂç° -->
        <TabControl Grid.Row="0">
            <TabItem Header="Âü∫Êú¨‰ø°ÊÅØ">
                <StackPanel Margin="10">
                    <Label Content="Â∑•‰ΩúÊµÅÂêçÁß∞:"/>
                    <TextBox x:Name="WorkflowNameTextBox" Margin="0,0,0,10"/>

                    <Label Content="ÁâàÊú¨Âè∑:"/>
                    <TextBox x:Name="VersionTextBox" Margin="0,0,0,10"/>

                    <Label Content="Á±ªÂà´:"/>
                    <ComboBox x:Name="CategoryComboBox" Margin="0,0,0,10">
                        <ComboBoxItem Content="ÂÆ°ÊâπÁ±ª" Tag="Approval"/>
                        <ComboBoxItem Content="ÈááË¥≠Á±ª" Tag="Purchase"/>
                        <ComboBoxItem Content="‰∫∫‰∫ãÁ±ª" Tag="HR"/>
                        <ComboBoxItem Content="Ë¥¢Âä°Á±ª" Tag="Finance"/>
                        <ComboBoxItem Content="ITÁ±ª" Tag="IT"/>
                        <ComboBoxItem Content="ÈÄöÁî®Á±ª" Tag="General"/>
                    </ComboBox>

                    <Label Content="ÊèèËø∞:"/>
                    <TextBox x:Name="DescriptionTextBox" AcceptsReturn="True" Height="100" 
                             TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>

                    <Label Content="ÂàõÂª∫ËÄÖ:" Margin="0,10,0,0"/>
                    <TextBox x:Name="CreatedByTextBox"/>

                    <CheckBox x:Name="IsActiveCheckBox" Content="ÊøÄÊ¥ªÁä∂ÊÄÅ" Margin="0,10,0,0" IsChecked="True"/>
                </StackPanel>
            </TabItem>

            <TabItem Header="ÊâßË°åËÆæÁΩÆ">
                <StackPanel Margin="10">
                    <Label Content="ÈªòËÆ§Ë∂ÖÊó∂Êó∂Èó¥(Â∞èÊó∂):"/>
                    <TextBox x:Name="DefaultTimeoutTextBox" Margin="0,0,0,10"/>

                    <Label Content="ÊúÄÂ§ßÂπ∂ÂèëÂÆû‰æãÊï∞:"/>
                    <TextBox x:Name="MaxConcurrentInstancesTextBox" Margin="0,0,0,10"/>

                    <Label Content="‰ºòÂÖàÁ∫ß:"/>
                    <ComboBox x:Name="PriorityComboBox" Margin="0,0,0,10">
                        <ComboBoxItem Content="‰Ωé" Tag="Low"/>
                        <ComboBoxItem Content="ÊôÆÈÄö" Tag="Normal"/>
                        <ComboBoxItem Content="È´ò" Tag="High"/>
                        <ComboBoxItem Content="Á¥ßÊÄ•" Tag="Urgent"/>
                    </ComboBox>

                    <CheckBox x:Name="EnableLoggingCheckBox" Content="ÂêØÁî®ËØ¶ÁªÜÊó•Âøó" IsChecked="True" Margin="0,0,0,10"/>
                    <CheckBox x:Name="EnableRetryCheckBox" Content="ÂêØÁî®Ëá™Âä®ÈáçËØï" Margin="0,0,0,10"/>

                    <Label Content="ÈáçËØïÊ¨°Êï∞:" Margin="0,10,0,0"/>
                    <TextBox x:Name="RetryCountTextBox" Text="3"/>

                    <Label Content="ÈáçËØïÈó¥Èöî(ÂàÜÈíü):" Margin="0,10,0,0"/>
                    <TextBox x:Name="RetryIntervalTextBox" Text="5"/>
                </StackPanel>
            </TabItem>

            <TabItem Header="ÈÄöÁü•ËÆæÁΩÆ">
                <StackPanel Margin="10">
                    <Label Content="ÈªòËÆ§ÈÄöÁü•ÊñπÂºè:"/>
                    <CheckBox x:Name="EmailNotificationCheckBox" Content="ÈÇÆ‰ª∂ÈÄöÁü•" IsChecked="True" Margin="0,5"/>
                    <CheckBox x:Name="SmsNotificationCheckBox" Content="Áü≠‰ø°ÈÄöÁü•" Margin="0,5"/>
                    <CheckBox x:Name="SystemNotificationCheckBox" Content="Á≥ªÁªüÈÄöÁü•" IsChecked="True" Margin="0,5"/>

                    <Label Content="ÁÆ°ÁêÜÂëòÈÇÆÁÆ±:" Margin="0,10,0,0"/>
                    <TextBox x:Name="AdminEmailTextBox" Margin="0,0,0,10"/>

                    <Label Content="ÈÇÆ‰ª∂Ê®°Êùø:"/>
                    <ComboBox x:Name="EmailTemplateComboBox" Margin="0,0,0,10">
                        <ComboBoxItem Content="ÈªòËÆ§Ê®°Êùø"/>
                        <ComboBoxItem Content="ÁÆÄÊ¥ÅÊ®°Êùø"/>
                        <ComboBoxItem Content="ËØ¶ÁªÜÊ®°Êùø"/>
                    </ComboBox>

                    <CheckBox x:Name="NotifyOnStartCheckBox" Content="ÂêØÂä®Êó∂ÈÄöÁü•" Margin="0,5"/>
                    <CheckBox x:Name="NotifyOnCompleteCheckBox" Content="ÂÆåÊàêÊó∂ÈÄöÁü•" IsChecked="True" Margin="0,5"/>
                    <CheckBox x:Name="NotifyOnErrorCheckBox" Content="ÈîôËØØÊó∂ÈÄöÁü•" IsChecked="True" Margin="0,5"/>
                </StackPanel>
            </TabItem>

            <TabItem Header="ÂÆâÂÖ®ËÆæÁΩÆ">
                <StackPanel Margin="10">
                    <Label Content="ËÆøÈóÆÊùÉÈôê:"/>
                    <ComboBox x:Name="AccessLevelComboBox" Margin="0,0,0,10">
                        <ComboBoxItem Content="ÂÖ¨ÂºÄ" Tag="Public"/>
                        <ComboBoxItem Content="ÂÜÖÈÉ®" Tag="Internal"/>
                        <ComboBoxItem Content="ÁßÅÊúâ" Tag="Private"/>
                    </ComboBox>

                    <Label Content="ÂÖÅËÆ∏ÁöÑÁî®Êà∑ÁªÑ:"/>
                    <TextBox x:Name="AllowedGroupsTextBox" AcceptsReturn="True" Height="60" 
                             TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                             ToolTip="Â§ö‰∏™Áî®Êà∑ÁªÑÁî®ÂàÜÂè∑ÂàÜÈöî" Margin="0,0,0,10"/>

                    <CheckBox x:Name="RequireApprovalToStartCheckBox" Content="ÂêØÂä®ÈúÄË¶ÅÂÆ°Êâπ" Margin="0,5"/>
                    <CheckBox x:Name="EncryptDataCheckBox" Content="Âä†ÂØÜÊïèÊÑüÊï∞ÊçÆ" Margin="0,5"/>
                    <CheckBox x:Name="AuditTrailCheckBox" Content="ÂêØÁî®ÂÆ°ËÆ°Ë∑üË∏™" IsChecked="True" Margin="0,5"/>

                    <Label Content="Êï∞ÊçÆ‰øùÁïôÊúü(Â§©):" Margin="0,10,0,0"/>
                    <TextBox x:Name="DataRetentionDaysTextBox" Text="365"/>
                </StackPanel>
            </TabItem>
        </TabControl>

        <!-- ÊåâÈíÆ -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button x:Name="OkButton" Content="Á°ÆÂÆö" Width="80" Height="30" Margin="0,0,10,0" IsDefault="True"/>
            <Button x:Name="CancelButton" Content="ÂèñÊ∂à" Width="80" Height="30" IsCancel="True"/>
            <Button x:Name="ApplyButton" Content="Â∫îÁî®" Width="80" Height="30" Margin="10,0,0,0"/>
        </StackPanel>
    </Grid>
</Window>

<!-- ==================== Â∑•‰ΩúÊµÅËøêË°åÁä∂ÊÄÅÁ™óÂè£ ==================== -->
<!-- Views/Dialogs/WorkflowExecutionWindow.xaml -->
<Window x:Class="WorkflowDesigner.Views.Dialogs.WorkflowExecutionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:NodeNetwork.Views;assembly=NodeNetwork"
        Title="Â∑•‰ΩúÊµÅÊâßË°åÁõëÊéß" Height="700" Width="1000" ResizeMode="CanResize"
        WindowStartupLocation="CenterOwner">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Â∑•ÂÖ∑Ê†è -->
        <ToolBar Grid.Row="0" Background="#F5F5F5">
            <Button x:Name="PauseButton" ToolTip="ÊöÇÂÅú">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="‚è∏Ô∏è" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="ÊöÇÂÅú"/>
                </StackPanel>
            </Button>
            <Button x:Name="ResumeButton" ToolTip="ÁªßÁª≠">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="‚ñ∂Ô∏è" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="ÁªßÁª≠"/>
                </StackPanel>
            </Button>
            <Button x:Name="StopExecutionButton" ToolTip="ÂÅúÊ≠¢">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="‚èπÔ∏è" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="ÂÅúÊ≠¢"/>
                </StackPanel>
            </Button>
            <Separator/>
            <Button x:Name="RefreshStatusButton" ToolTip="Âà∑Êñ∞Áä∂ÊÄÅ">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="üîÑ" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Âà∑Êñ∞"/>
                </StackPanel>
            </Button>
        </ToolBar>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <!-- Â∑•‰ΩúÊµÅÁîªÂ∏É -->
            <views:NetworkView x:Name="ExecutionNetworkView" Grid.Column="0" IsReadOnly="True">
                <views:NetworkView.NetworkBackground>
                    <DrawingBrush TileMode="Tile" Viewport="0,0,20,20" ViewportUnits="Absolute" 
                                  Viewbox="0,0,20,20" ViewboxUnits="Absolute" Opacity="0.1">
                        <DrawingBrush.Drawing>
                            <GeometryDrawing Brush="Blue">
                                <GeometryDrawing.Geometry>
                                    <RectangleGeometry Rect="0,0,1,1"/>
                                </GeometryDrawing.Geometry>
                            </GeometryDrawing>
                        </DrawingBrush.Drawing>
                    </DrawingBrush>
                </views:NetworkView.NetworkBackground>
            </views:NetworkView>

            <GridSplitter Grid.Column="1" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Background="#DDDDDD"/>

            <!-- ÊâßË°å‰ø°ÊÅØÈù¢Êùø -->
            <Grid Grid.Column="2" Background="#FAFAFA">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- ÊâßË°åÁä∂ÊÄÅÊëòË¶Å -->
                <Border Grid.Row="0" Background="#E3F2FD" Padding="10">
                    <StackPanel>
                        <TextBlock Text="ÊâßË°åÁä∂ÊÄÅ" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Áä∂ÊÄÅ:" Margin="0,0,10,5"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" x:Name="StatusText" FontWeight="Bold" Margin="0,0,0,5"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="ËøõÂ∫¶:" Margin="0,0,10,5"/>
                            <ProgressBar Grid.Row="1" Grid.Column="1" x:Name="ProgressBar" Height="20" Margin="0,0,0,5"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="ÂΩìÂâçËäÇÁÇπ:" Margin="0,0,10,5"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" x:Name="CurrentNodeText" Margin="0,0,0,5"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="ËøêË°åÊó∂Èó¥:" Margin="0,0,10,0"/>
                            <TextBlock Grid.Row="3" Grid.Column="1" x:Name="ElapsedTimeText"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- ËØ¶ÁªÜ‰ø°ÊÅØÈÄâÈ°πÂç° -->
                <TabControl Grid.Row="1" Margin="5">
                    <TabItem Header="ËäÇÁÇπÁä∂ÊÄÅ">
                        <DataGrid x:Name="NodeStatusDataGrid" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ËäÇÁÇπ" Binding="{Binding NodeName}" Width="100"/>
                                <DataGridTextColumn Header="Áä∂ÊÄÅ" Binding="{Binding Status}" Width="80"/>
                                <DataGridTextColumn Header="ÂºÄÂßãÊó∂Èó¥" Binding="{Binding StartTime}" Width="120"/>
                                <DataGridTextColumn Header="ÁªìÊùüÊó∂Èó¥" Binding="{Binding EndTime}" Width="120"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>

                    <TabItem Header="ÂèòÈáè">
                        <DataGrid x:Name="VariablesDataGrid" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ÂèòÈáèÂêç" Binding="{Binding Name}" Width="100"/>
                                <DataGridTextColumn Header="ÂÄº" Binding="{Binding Value}" Width="*"/>
                                <DataGridTextColumn Header="Á±ªÂûã" Binding="{Binding Type}" Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </TabItem>

                    <TabItem Header="Êó•Âøó">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <TextBox x:Name="LogTextBox" IsReadOnly="True" Background="Black" 
                                     Foreground="Lime" FontFamily="Consolas" FontSize="10"
                                     TextWrapping="Wrap"/>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>

        <!-- Áä∂ÊÄÅÊ†è -->
        <StatusBar Grid.Row="2" Background="#F0F0F0">
            <TextBlock x:Name="ExecutionStatusText" Text="ÊâßË°å‰∏≠..."/>
            <Separator/>
            <TextBlock x:Name="ExecutionTimeText"/>
        </StatusBar>
    </Grid>
</Window>

<!-- ==================== È°πÁõÆÊñá‰ª∂ ==================== -->
<!-- WorkflowDesigner.csproj -->
<Project Sdk="Microsoft.NET.Sdk.WindowsDesktop">
  <PropertyGroup>
    <TargetFramework>net6.0-windows</TargetFramework>
    <OutputType>WinExe</OutputType>
    <UseWPF>true</UseWPF>
    <StartupObject>WorkflowDesigner.App</StartupObject>
    <AssemblyTitle>Â∑•‰ΩúÊµÅÂèØËßÜÂåñËÆæËÆ°Âô®</AssemblyTitle>
    <AssemblyDescription>Âü∫‰∫éWPFÂíåNodeNetworkÁöÑ‰ºÅ‰∏öÁ∫ßÂ∑•‰ΩúÊµÅËÆæËÆ°Âô®</AssemblyDescription>
    <AssemblyCompany>WorkflowDesigner Corp</AssemblyCompany>
    <AssemblyProduct>Workflow Visual Designer</AssemblyProduct>
    <Copyright>Copyright ¬© 2025</Copyright>
    <AssemblyVersion>1.0.0.0</AssemblyVersion>
    <FileVersion>1.0.0.0</FileVersion>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="ReactiveUI.WPF" Version="19.5.31" />
    <PackageReference Include="ReactiveUI.Fody" Version="19.5.31" />
    <PackageReference Include="NodeNetwork" Version="2.1.0" />
    <PackageReference Include="NodeNetworkToolkit" Version="2.1.0" />
    <PackageReference Include="Extended.Wpf.Toolkit" Version="4.5.0" />
    <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="7.0.0" />
    <PackageReference Include="Microsoft.Extensions.Hosting" Version="7.0.1" />
    <PackageReference Include="Microsoft.Extensions.Configuration" Version="7.0.0" />
    <PackageReference Include="Microsoft.Extensions.Configuration.Json" Version="7.0.0" />
    <PackageReference Include="Microsoft.Extensions.Logging" Version="7.0.0" />
    <PackageReference Include="Serilog.Extensions.Hosting" Version="7.0.0" />
    <PackageReference Include="Serilog.Sinks.File" Version="5.0.0" />
    <PackageReference Include="System.ComponentModel.Annotations" Version="5.0.0" />
  </ItemGroup>

  <ItemGroup>
    <Resource Include="Resources\**\*" />
  </ItemGroup>

  